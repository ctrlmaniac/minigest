import{R as l,j as e,F as O,a as i,aP as te,aQ as ne,Y as I,B as m,a1 as ae}from"./index-5f51ca44.js";import{l as re}from"./list-046f23af.js";import{l as ie}from"./list-127e2259.js";import{u as Q,a as G}from"./hooks-1f293e4f.js";import{S as oe}from"./SaveFab-142d182a.js";import{a as V,b as L}from"./DialogContent-113ce8ae.js";import{T as f}from"./TextField-fd5a3e96.js";import{D as $}from"./DialogActions-494308e9.js";import{B as E}from"./Button-5e49282d.js";import{a as le,E as se}from"./index-30e337fd.js";import{T as F}from"./Typography-6ee06c79.js";import{P as A}from"./Paper-cffb93af.js";import{G as d}from"./Grid-8800b093.js";import{A as P}from"./Autocomplete-15c8cfe0.js";import{A as W,I as j}from"./Alert-368acf87.js";import{T as k,a as y,b as o,c as R}from"./TableRow-500111fc.js";import{T as B}from"./TableHead-1b4dafed.js";import{I as T}from"./IconTrash-e38c8d7f.js";import"./Container-87c2bf1f.js";import"./Fab-998d6591.js";import"./ButtonBase-8b0d506c.js";import"./createReactComponent-ea0485c8.js";import"./useTheme-90c811d5.js";import"./Modal-3eb94ddf.js";import"./utils-7d94707b.js";import"./Grow-62fe4847.js";import"./List-91c3af84.js";import"./createSvgIcon-1a708d24.js";import"./Popper-c4af9e57.js";import"./ListSubheader-dd2b3d07.js";const ce=({open:p,handleClose:c,onSubmit:u})=>{const[t,s]=l.useState({aliquota:22,imponibile:0,imposta:0}),[r,h]=l.useState({aliquota:!1,imponibile:!1,imposta:!1}),[z,v]=l.useState(!0);l.useEffect(()=>{v(!Object.values(r).every(g=>g===!1))},[r]);const b=g=>{const{value:S,name:C,required:x}=g.target;s({...t,[C]:S}),x&&h({...r,[C]:S.toString().length<1})},D=()=>{c(!1),u(t)};return e(O,{children:i(V,{open:p,onClose:()=>c(!1),children:[i(L,{children:[e(f,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:t.aliquota,error:r.aliquota,onChange:b}),e(f,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:t.imponibile,error:r.imponibile,onChange:b}),e(f,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:t.imposta,error:r.imposta,onChange:b})]}),e($,{children:e(E,{disabled:z,onClick:D,children:"salva"})})]})})};function de(p){return async c=>{le.post(`${se.FATTURE}`,p).then(u=>{c(te(u.data)),window.location.href=`/app/docfisc/fatture/dettagli/${u.data.id}`}).catch(u=>{c(ne(u.message))})}}const me=({open:p,handleClose:c,onSubmit:u})=>{const[t,s]=l.useState({data:new Date().toISOString().split("T")[0],importo:0}),[r,h]=l.useState({data:!1,importo:!1}),[z,v]=l.useState(!0);l.useEffect(()=>{v(!Object.values(r).every(g=>g===!1))},[r]);const b=g=>{const{value:S,name:C,required:x}=g.target;s({...t,[C]:S}),x&&h({...r,[C]:S.toString().length<1})},D=()=>{c(!1),u(t)};return e(O,{children:i(V,{open:p,onClose:()=>c(!1),children:[i(L,{children:[e(f,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:t.data,error:r.data,onChange:b,type:"date"}),e(f,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:t.importo,error:r.importo,onChange:b})]}),e($,{children:e(E,{disabled:z,onClick:D,children:"salva"})})]})})},ue=({open:p,handleClose:c,onSubmit:u})=>{const[t,s]=l.useState({data:new Date().toISOString().split("T")[0],importo:0}),[r,h]=l.useState({data:!1,importo:!1}),[z,v]=l.useState(!0);l.useEffect(()=>{v(!Object.values(r).every(g=>g===!1))},[r]);const b=g=>{const{value:S,name:C,required:x}=g.target;s({...t,[C]:S}),x&&h({...r,[C]:S.toString().length<1})},D=()=>{c(!1),u(t)};return e(O,{children:i(V,{open:p,onClose:()=>c(!1),children:[i(L,{children:[e(f,{fullWidth:!0,label:"Data Pagamento",name:"data",margin:"normal",value:t.data,error:r.data,onChange:b,type:"date"}),e(f,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:t.importo,error:r.importo,onChange:b})]}),e($,{children:e(E,{disabled:z,onClick:D,children:"salva"})})]})})},he=({tipiDocumento:p,aziende:c})=>{const u=Q(),[t,s]=l.useState({cedente:null,committente:null,tipoDocumento:I.find(p,["descrizione","fattura"])||null,data:new Date().toISOString().split("T")[0],numero:"",totale:0,reparti:[],scadenze:[],pagamenti:[]}),[r,h]=l.useState({cedente:!0,committente:!0,tipoDocumento:!1,data:!1,numero:!0,totale:!1,reparti:!0,scadenze:!0,pagamenti:!1}),[z,v]=l.useState(!1),[b,D]=l.useState(!1),[g,S]=l.useState(!1),[C,x]=l.useState(!0);l.useEffect(()=>{x(!Object.values(r).every(n=>n===!1))},[r]);const H=(n,a,q)=>{s({...t,cedente:a}),h({...r,cedente:I.isEmpty(a)})},N=(n,a,q)=>{s({...t,committente:a}),h({...r,committente:I.isEmpty(a)})},U=(n,a,q)=>{s({...t,tipoDocumento:a}),h({...r,tipoDocumento:I.isEmpty(a)})},w=n=>{const{value:a,name:q,required:ee}=n.target;s({...t,[q]:a}),ee&&h({...r,[q]:a.length<1})},Y=n=>{const a=[...t.reparti,n];s({...t,reparti:a}),h({...r,reparti:a.length<1})},J=n=>{const a=[...t.reparti];a.splice(n,1),s({...t,reparti:a}),h({...r,reparti:a.length<1})},K=n=>{const a=[...t.scadenze,n];s({...t,scadenze:a}),h({...r,scadenze:a.length<1})},M=n=>{const a=[...t.scadenze];a.splice(n,1),s({...t,scadenze:a}),h({...r,scadenze:a.length<1})},X=n=>{const a=[...t.pagamenti,n];s({...t,pagamenti:a})},Z=n=>{const a=[...t.pagamenti];a.splice(n,1),s({...t,pagamenti:a})},_=()=>{const n={cedente:t.cedente,committente:t.committente,tipoDocumento:t.tipoDocumento,data:t.data,numero:t.numero,totale:t.totale,reparti:t.reparti,scadenze:t.scadenze,pagamenti:t.pagamenti};u(de(n))};return i(O,{children:[e(m,{mb:3,children:e(F,{variant:"h3",children:"Aggiungi Fattura"})}),e(m,{mb:3,children:e(A,{children:e(m,{p:2,children:i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(d,{item:!0,xs:12,children:e(P,{fullWidth:!0,disablePortal:!0,options:p,getOptionLabel:n=>n.descrizione,value:t.tipoDocumento,isOptionEqualToValue:(n,a)=>n.descrizione===a.descrizione,onChange:U,renderInput:n=>e(f,{...n,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:r.tipoDocumento})})}),e(d,{item:!0,xs:12,sm:6,children:e(P,{fullWidth:!0,disablePortal:!0,options:c,getOptionLabel:n=>n.denominazione,value:t.cedente,isOptionEqualToValue:(n,a)=>n.denominazione===a.denominazione,onChange:H,renderInput:n=>e(f,{...n,label:"Cedente",name:"cedente",required:!0,error:r.cedente})})}),e(d,{item:!0,xs:12,sm:6,children:e(P,{fullWidth:!0,disablePortal:!0,options:c,getOptionLabel:n=>n.denominazione,value:t.committente,isOptionEqualToValue:(n,a)=>n.denominazione===a.denominazione,onChange:N,renderInput:n=>e(f,{...n,label:"Committente",name:"committente",required:!0,error:r.committente})})}),e(d,{item:!0,xs:12,sm:6,children:e(f,{fullWidth:!0,label:"Data",name:"data",value:t.data,error:r.data,onChange:w,type:"date",required:!0})}),e(d,{item:!0,xs:12,sm:6,children:e(f,{fullWidth:!0,label:"Numero",name:"numero",value:t.numero,error:r.numero,onChange:w,required:!0})}),e(d,{item:!0,xs:12,children:e(f,{fullWidth:!0,label:"Totale documento",name:"totale",value:t.totale,error:r.totale,onChange:w,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(m,{mb:3,children:e(A,{children:i(m,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(d,{item:!0,xs:6,children:e(m,{sx:{textAlign:"right"},children:e(E,{onClick:()=>v(!0),children:"aggiungi"})})})]}),e(m,{mt:2,children:I.isEmpty(t.reparti)?e(W,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):i(k,{children:[e(B,{children:i(y,{children:[e(o,{children:"Aliquota"}),e(o,{children:"Imponibile"}),e(o,{children:"Imposta"}),e(o,{sx:{width:50},align:"center",children:e(T,{})})]})}),e(R,{children:t.reparti.map((n,a)=>i(y,{children:[i(o,{children:["% ",n.aliquota]}),i(o,{children:["€ ",n.imponibile]}),i(o,{children:["€ ",n.imposta]}),e(o,{children:e(j,{color:"error",onClick:()=>J(a),children:e(T,{})})})]},a))})]})})]})})}),e(m,{mb:3,children:e(A,{children:i(m,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(d,{item:!0,xs:6,children:e(m,{sx:{textAlign:"right"},children:e(E,{onClick:()=>D(!0),children:"aggiungi"})})})]}),e(m,{mt:2,children:I.isEmpty(t.scadenze)?e(W,{severity:"error",children:"Devi aggiungere almeno una scadenza!"}):i(k,{children:[e(B,{children:i(y,{children:[e(o,{children:"Data"}),e(o,{children:"Importo"}),e(o,{sx:{width:50},align:"center",children:e(T,{})})]})}),e(R,{children:t.scadenze.map((n,a)=>i(y,{children:[e(o,{children:n.data}),i(o,{children:["€ ",n.importo]}),e(o,{children:e(j,{color:"error",onClick:()=>M(a),children:e(T,{})})})]},a))})]})})]})})}),e(m,{children:e(A,{children:i(m,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Pagamenti"})}),e(d,{item:!0,xs:6,children:e(m,{sx:{textAlign:"right"},children:e(E,{onClick:()=>S(!0),children:"aggiungi"})})})]}),e(m,{mt:2,children:I.isEmpty(t.pagamenti)?e(W,{severity:"warning",children:"Questa fattura non ha pagamenti registrati"}):i(k,{children:[e(B,{children:i(y,{children:[e(o,{children:"Data"}),e(o,{children:"Importo"}),e(o,{sx:{width:50},align:"center",children:e(T,{})})]})}),e(R,{children:t.pagamenti.map((n,a)=>i(y,{children:[e(o,{children:n.data}),i(o,{children:["€ ",n.importo]}),e(o,{children:e(j,{color:"error",onClick:()=>Z(a),children:e(T,{})})})]},a))})]})})]})})}),e(ce,{open:z,handleClose:v,onSubmit:Y}),e(me,{open:b,handleClose:D,onSubmit:K}),e(ue,{open:g,handleClose:S,onSubmit:X}),e(oe,{disabled:C,handleClick:_})]})},He=()=>{const p=Q(),{list:c,listing:u}=G(r=>r.aziende),{list:t,listing:s}=G(r=>r.tipiDocFisc);return l.useEffect(()=>{p(re()),p(ie())},[]),u||s?e(ae,{}):e(he,{aziende:c,tipiDocumento:t})};export{He as default};
