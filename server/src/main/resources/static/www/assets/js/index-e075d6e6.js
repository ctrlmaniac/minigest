import{R as m,j as e,F as O,a as i,aY as ne,aZ as re,B as g,Y as x,ad as ae,a1 as ie}from"./index-5f51ca44.js";import{E as oe}from"./ErrorScreen-79d85a92.js";import{l as le}from"./list-046f23af.js";import{l as se}from"./list-127e2259.js";import{u as N,a as w}from"./hooks-1f293e4f.js";import{S as ce}from"./SaveFab-142d182a.js";import{a as L,b as $}from"./DialogContent-113ce8ae.js";import{T as S}from"./TextField-fd5a3e96.js";import{D as G}from"./DialogActions-494308e9.js";import{B as T}from"./Button-5e49282d.js";import{a as de,E as me}from"./index-30e337fd.js";import{T as F}from"./Typography-6ee06c79.js";import{P as A}from"./Paper-cffb93af.js";import{G as h}from"./Grid-8800b093.js";import{A as W}from"./Autocomplete-15c8cfe0.js";import{A as j,I as k}from"./Alert-368acf87.js";import{T as R,a as I,b as d,c as B}from"./TableRow-500111fc.js";import{T as V}from"./TableHead-1b4dafed.js";import{I as y}from"./IconTrash-e38c8d7f.js";import{g as ue}from"./get-9f694a12.js";import"./Container-87c2bf1f.js";import"./Fab-998d6591.js";import"./ButtonBase-8b0d506c.js";import"./createReactComponent-ea0485c8.js";import"./useTheme-90c811d5.js";import"./Modal-3eb94ddf.js";import"./utils-7d94707b.js";import"./Grow-62fe4847.js";import"./List-91c3af84.js";import"./createSvgIcon-1a708d24.js";import"./Popper-c4af9e57.js";import"./ListSubheader-dd2b3d07.js";const pe=({open:b,handleClose:u,onSubmit:s})=>{const[o,n]=m.useState({aliquota:22,imponibile:0,imposta:0}),[a,l]=m.useState({aliquota:!1,imponibile:!1,imposta:!1}),[p,D]=m.useState(!0);m.useEffect(()=>{D(!Object.values(a).every(c=>c===!1))},[a]);const f=c=>{const{value:v,name:C,required:E}=c.target;n({...o,[C]:v}),E&&l({...a,[C]:v.toString().length<1})},z=()=>{u(!1),s(o)};return e(O,{children:i(L,{open:b,onClose:()=>u(!1),children:[i($,{children:[e(S,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:o.aliquota,error:a.aliquota,onChange:f}),e(S,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:o.imponibile,error:a.imponibile,onChange:f}),e(S,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:o.imposta,error:a.imposta,onChange:f})]}),e(G,{children:e(T,{disabled:p,onClick:z,children:"salva"})})]})})};function he(b,u){return async s=>{de.put(`${me.FATTURE}/${b}`,u).then(o=>{s(ne(o.data)),window.location.href=`/app/docfisc/fatture/dettagli/${o.data.id}`}).catch(o=>{s(re(o.message))})}}const ge=({open:b,handleClose:u,onSubmit:s})=>{const[o,n]=m.useState({data:new Date().toISOString().split("T")[0],importo:0}),[a,l]=m.useState({data:!1,importo:!1}),[p,D]=m.useState(!0);m.useEffect(()=>{D(!Object.values(a).every(c=>c===!1))},[a]);const f=c=>{const{value:v,name:C,required:E}=c.target;n({...o,[C]:v}),E&&l({...a,[C]:v.toString().length<1})},z=()=>{u(!1),s(o)};return e(O,{children:i(L,{open:b,onClose:()=>u(!1),children:[i($,{children:[e(S,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:o.data,error:a.data,onChange:f,type:"date"}),e(S,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:o.importo,error:a.importo,onChange:f})]}),e(G,{children:e(T,{disabled:p,onClick:z,children:"salva"})})]})})},fe=({open:b,handleClose:u,onSubmit:s})=>{const[o,n]=m.useState({data:new Date().toISOString().split("T")[0],importo:0}),[a,l]=m.useState({data:!1,importo:!1}),[p,D]=m.useState(!0);m.useEffect(()=>{D(!Object.values(a).every(c=>c===!1))},[a]);const f=c=>{const{value:v,name:C,required:E}=c.target;n({...o,[C]:v}),E&&l({...a,[C]:v.toString().length<1})},z=()=>{u(!1),s(o)};return e(O,{children:i(L,{open:b,onClose:()=>u(!1),children:[i($,{children:[e(S,{fullWidth:!0,label:"Data Pagamento",name:"data",margin:"normal",value:o.data,error:a.data,onChange:f,type:"date"}),e(S,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:o.importo,error:a.importo,onChange:f})]}),e(G,{children:e(T,{disabled:p,onClick:z,children:"salva"})})]})})},be=({tipiDocumento:b,aziende:u,dettagli:s})=>{const o=N(),[n,a]=m.useState({cedente:s.cedente,committente:s.committente,tipoDocumento:s.tipoDocumento,data:s.data,numero:s.numero,totale:s.totale,reparti:s.reparti,scadenze:s.scadenze,pagamenti:s.pagamenti}),[l,p]=m.useState({cedente:!1,committente:!1,tipoDocumento:!1,data:!1,numero:!1,totale:!1,reparti:!1,scadenze:!1,pagamenti:!1}),[D,f]=m.useState(!1),[z,c]=m.useState(!1),[v,C]=m.useState(!1),[E,Y]=m.useState(!0);m.useEffect(()=>{Y(!Object.values(l).every(t=>t===!1))},[l]);const H=(t,r,q)=>{a({...n,cedente:r}),p({...l,cedente:x.isEmpty(r)})},M=(t,r,q)=>{a({...n,committente:r}),p({...l,committente:x.isEmpty(r)})},U=(t,r,q)=>{a({...n,tipoDocumento:r}),p({...l,tipoDocumento:x.isEmpty(r)})},P=t=>{const{value:r,name:q,required:te}=t.target;a({...n,[q]:r}),te&&p({...l,[q]:r.toString().length<1})},Z=t=>{const r=[...n.reparti,t];a({...n,reparti:r}),p({...l,reparti:r.length<1})},J=t=>{const r=[...n.reparti];r.splice(t,1),a({...n,reparti:r}),p({...l,reparti:r.length<1})},K=t=>{const r=[...n.scadenze,t];a({...n,scadenze:r}),p({...l,scadenze:r.length<1})},Q=t=>{const r=[...n.scadenze];r.splice(t,1),a({...n,scadenze:r}),p({...l,scadenze:r.length<1})},X=t=>{const r=[...n.pagamenti,t];a({...n,pagamenti:r})},_=t=>{const r=[...n.pagamenti];r.splice(t,1),a({...n,pagamenti:r})},ee=()=>{const t={cedente:n.cedente,committente:n.committente,tipoDocumento:n.tipoDocumento,data:n.data,numero:n.numero,totale:n.totale,reparti:n.reparti,scadenze:n.scadenze,pagamenti:n.pagamenti};o(he(s.id,t))};return i(O,{children:[e(g,{mb:3,children:e(F,{variant:"h3",children:"Aggiungi Fattura"})}),e(g,{mb:3,children:e(A,{children:e(g,{p:2,children:i(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(h,{item:!0,xs:12,children:e(W,{fullWidth:!0,disablePortal:!0,options:b,getOptionLabel:t=>t.descrizione,value:n.tipoDocumento,isOptionEqualToValue:(t,r)=>t.descrizione===r.descrizione,onChange:U,renderInput:t=>e(S,{...t,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:l.tipoDocumento})})}),e(h,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:u,getOptionLabel:t=>t.denominazione,value:n.cedente,isOptionEqualToValue:(t,r)=>t.denominazione===r.denominazione,onChange:H,renderInput:t=>e(S,{...t,label:"Cedente",name:"cedente",required:!0,error:l.cedente})})}),e(h,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:u,getOptionLabel:t=>t.denominazione,value:n.committente,isOptionEqualToValue:(t,r)=>t.denominazione===r.denominazione,onChange:M,renderInput:t=>e(S,{...t,label:"Committente",name:"committente",required:!0,error:l.committente})})}),e(h,{item:!0,xs:12,sm:6,children:e(S,{fullWidth:!0,label:"Data",name:"data",value:n.data,error:l.data,onChange:P,type:"date",required:!0})}),e(h,{item:!0,xs:12,sm:6,children:e(S,{fullWidth:!0,label:"Numero",name:"numero",value:n.numero,error:l.numero,onChange:P,required:!0})}),e(h,{item:!0,xs:12,children:e(S,{fullWidth:!0,label:"Totale documento",name:"totale",value:n.totale,error:l.totale,onChange:P,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(g,{mb:3,children:e(A,{children:i(g,{p:2,children:[i(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(h,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(h,{item:!0,xs:6,children:e(g,{sx:{textAlign:"right"},children:e(T,{onClick:()=>f(!0),children:"aggiungi"})})})]}),e(g,{mt:2,children:x.isEmpty(n.reparti)?e(j,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):i(R,{children:[e(V,{children:i(I,{children:[e(d,{children:"Aliquota"}),e(d,{children:"Imponibile"}),e(d,{children:"Imposta"}),e(d,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(B,{children:n.reparti.map((t,r)=>i(I,{children:[i(d,{children:["% ",t.aliquota]}),i(d,{children:["€ ",t.imponibile]}),i(d,{children:["€ ",t.imposta]}),e(d,{children:e(k,{color:"error",onClick:()=>J(r),children:e(y,{})})})]},r))})]})})]})})}),e(g,{mb:3,children:e(A,{children:i(g,{p:2,children:[i(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(h,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(h,{item:!0,xs:6,children:e(g,{sx:{textAlign:"right"},children:e(T,{onClick:()=>c(!0),children:"aggiungi"})})})]}),e(g,{mt:2,children:x.isEmpty(n.scadenze)?e(j,{severity:"error",children:"Devi aggiungere almeno una scadenza!"}):i(R,{children:[e(V,{children:i(I,{children:[e(d,{children:"Data"}),e(d,{children:"Importo"}),e(d,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(B,{children:n.scadenze.map((t,r)=>i(I,{children:[e(d,{children:t.data}),i(d,{children:["€ ",t.importo]}),e(d,{children:e(k,{color:"error",onClick:()=>Q(r),children:e(y,{})})})]},r))})]})})]})})}),e(g,{mb:3,children:e(A,{children:i(g,{p:2,children:[i(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(h,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Pagamenti"})}),e(h,{item:!0,xs:6,children:e(g,{sx:{textAlign:"right"},children:e(T,{onClick:()=>C(!0),children:"aggiungi"})})})]}),e(g,{mt:2,children:x.isEmpty(n.pagamenti)?e(j,{severity:"warning",children:"Nessun pagamento"}):i(R,{children:[e(V,{children:i(I,{children:[e(d,{children:"Data"}),e(d,{children:"Importo"}),e(d,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(B,{children:n.pagamenti.map((t,r)=>i(I,{children:[e(d,{children:t.data}),i(d,{children:["€ ",t.importo]}),e(d,{children:e(k,{color:"error",onClick:()=>_(r),children:e(y,{})})})]},r))})]})})]})})}),e(pe,{open:D,handleClose:f,onSubmit:Z}),e(ge,{open:z,handleClose:c,onSubmit:K}),e(fe,{open:v,handleClose:C,onSubmit:X}),e(ce,{disabled:E,handleClick:ee})]})},Ke=()=>{const b=N(),{id:u}=ae(),{dettagli:s,getting:o,getError:n}=w(c=>c.fatture),{list:a,listing:l,listError:p}=w(c=>c.aziende),{list:D,listing:f,listError:z}=w(c=>c.tipiDocFisc);return m.useEffect(()=>{b(le()),b(se()),u&&b(ue(u))},[u]),o||l||f?e(ie,{}):n||p||z?e(oe,{message:"Errore caricamento dati"}):e(be,{dettagli:s,aziende:a,tipiDocumento:D})};export{Ke as default};
