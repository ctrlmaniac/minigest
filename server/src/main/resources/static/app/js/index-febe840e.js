import{R as i,b as a,j as e,aw as B,ax as W,F as j,l as P,ai as k}from"./index-67254d02.js";import{u as O,a as H,B as p,T as y}from"./hooks-fccfb499.js";import{a as z,b as G}from"./DialogContent-14b40355.js";import{T as g}from"./TextField-4add7af0.js";import{D as U}from"./DialogActions-e591b99a.js";import{B as I}from"./Button-f80334d5.js";import{a as V,E as $}from"./index-c44c1a12.js";import{P as T}from"./Paper-3e81e2e3.js";import{G as q}from"./Grid-92817418.js";import{A as L}from"./Alert-7c7d6f34.js";import{T as N,a as F,b as l,c as _}from"./TableRow-b83a5f3c.js";import{T as J}from"./TableHead-ce5d8a6b.js";import{I as x}from"./IconTrash-ef31679c.js";import{I as K}from"./IconButton-3fae5024.js";import"./useTheme-b4ae5703.js";import"./Modal-36c42f6c.js";import"./utils-2b3ff743.js";import"./TransitionGroupContext-9ce3bcfc.js";import"./Grow-de51d2e5.js";import"./List-02219cef.js";import"./createSvgIcon-6b855daf.js";import"./ButtonBase-4000f0af.js";import"./createReactComponent-d33df1ab.js";const M=({open:f,handleClose:d,handleSubmit:u})=>{const[n,m]=i.useState({aliquota:22,totale:0,totaleAnnulli:0,totaleResi:0}),[o,s]=i.useState({aliquota:!1,totale:!1,totaleAnnulli:!1,totaleResi:!1}),h=v=>{const{name:C,value:D,required:R}=v.target;m({...n,[C]:D}),R&&s({...o,[C]:D.length<1})},[c,S]=i.useState(!0);i.useEffect(()=>{S(!Object.values(o).every(v=>v===!1))},[o]);const b=()=>{d(!1),u(n)};return a(z,{open:f,onClose:()=>d(!1),children:[a(G,{children:[e(g,{label:"aliquota",name:"aliquota",value:n.aliquota,error:o.aliquota,fullWidth:!0,required:!0,onChange:h,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale",name:"totale",value:n.totale,error:o.totale,fullWidth:!0,required:!0,onChange:h,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale annulli",name:"totaleAnnulli",value:n.totaleAnnulli,error:o.totaleAnnulli,fullWidth:!0,required:!0,onChange:h,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale resi",name:"totaleResi",value:n.totaleResi,error:o.totaleResi,fullWidth:!0,required:!0,onChange:h,margin:"normal",type:"number",inputProps:{step:.01}})]}),e(U,{children:e(I,{disabled:c,onClick:b,children:"Salva"})})]})};function Q(f){return async d=>{V.post(`${$.CHIUSURE_FISCALI}`,f).then(u=>{d(B(u.data)),window.location.href=`/app/docfisc/chiusure-fiscali/dettagli/${u.data.id}`}).catch(u=>{d(W(u.message))})}}const De=()=>{const f=O(),{selected:d}=H(t=>t.negozi),[u,n]=i.useState(!1),[m,o]=i.useState({data:new Date().toISOString().split("T")[0],totale:0,numeroDocFisc:0}),[s,h]=i.useState([]),[c,S]=i.useState({data:!1,totale:!1,numeroDocFisc:!1}),b=t=>{const{name:r,value:A,required:w}=t.target;o({...m,[r]:A}),w&&S({...c,[r]:A.length<1})},[v,C]=i.useState(!0);i.useEffect(()=>{const t=!Object.values(c).every(r=>r===!1);C(t||s.length<1)},[c,s]);const D=t=>{h([...s,t])},R=t=>{const r=[...s];r.splice(t,1),h(r)},E=()=>{const t={negozio:d,...m,reparti:[...s]};f(Q(t))};return a(j,{children:[e(p,{mb:3,children:e(y,{variant:"h3",children:"Aggiungi Chiusura Fiscale"})}),e(p,{mb:3,children:e(T,{children:a(p,{p:2,children:[e(g,{label:"Data",name:"data",value:m.data,error:c.data,fullWidth:!0,required:!0,onChange:b,margin:"normal",type:"date"}),e(g,{label:"Totale",name:"totale",value:m.totale,error:c.totale,fullWidth:!0,required:!0,onChange:b,margin:"normal",type:"number"}),e(g,{label:"Num. D.F.",name:"numeroDocFisc",value:m.numeroDocFisc,error:c.numeroDocFisc,fullWidth:!0,required:!0,onChange:b,margin:"normal",type:"number"})]})})}),e(p,{children:e(T,{children:a(p,{p:2,children:[a(q,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(q,{item:!0,xs:6,children:e(y,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(q,{item:!0,xs:6,children:e(p,{sx:{textAlign:"right"},children:e(I,{onClick:()=>n(!0),children:"aggiungi"})})})]}),e(p,{mt:2,children:P.isEmpty(s)?e(L,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):a(N,{children:[e(J,{children:a(F,{children:[e(l,{children:"Aliquota"}),e(l,{children:"Totale"}),e(l,{children:"Annulli"}),e(l,{children:"Resi"}),e(l,{sx:{width:50},align:"center",children:e(x,{})})]})}),e(_,{children:s.map((t,r)=>a(F,{children:[a(l,{children:[t.aliquota," %"]}),a(l,{children:[t.totale," €"]}),a(l,{children:[t.totaleAnnulli," €"]}),a(l,{children:[t.totaleResi," €"]}),e(l,{align:"center",children:e(K,{color:"error",onClick:()=>R(r),children:e(x,{})})})]},r))})]})})]})})}),e(M,{open:u,handleClose:n,handleSubmit:D}),e(k,{handleClick:E,disabled:v})]})};export{De as default};
