import{R as m,j as e,F as O,b as i,aR as ne,aS as ae,l as E,ak as re,ac as ie,o as oe,M as le}from"./index-222da0ba.js";import{l as se}from"./list-ae7dc43c.js";import{A as w,l as ce}from"./list-d1945695.js";import{u as G,B as g,T as F,a as W}from"./hooks-db4dee7a.js";import{a as L,b as $}from"./DialogContent-d1142615.js";import{T as S}from"./TextField-9f2cfd53.js";import{D as M}from"./DialogActions-6a8a3d75.js";import{B as T}from"./Button-30f411bc.js";import{a as de,E as me}from"./index-c44c1a12.js";import{P as A}from"./Paper-96727556.js";import{G as p}from"./Grid-c9b8ca58.js";import{A as R}from"./Alert-6c557f0c.js";import{T as j,a as I,b as d,c as k}from"./TableRow-00ec436f.js";import{T as B}from"./TableHead-137e9606.js";import{I as y}from"./IconTrash-628b6ddf.js";import{I as V}from"./IconButton-8b5a614b.js";import{g as ue}from"./get-49734fac.js";import"./Popper-a9fe7db2.js";import"./utils-50920ebd.js";import"./TransitionGroupContext-58f02f0d.js";import"./ListSubheader-69d8aba0.js";import"./Grow-dd1bfbaf.js";import"./useTheme-88693805.js";import"./createSvgIcon-208d5829.js";import"./ButtonBase-f82ec6e5.js";import"./Modal-821d5a1c.js";import"./List-670810c7.js";import"./createReactComponent-d2644421.js";const he=({open:b,handleClose:u,onSubmit:s})=>{const[o,n]=m.useState({aliquota:22,imponibile:0,imposta:0}),[r,l]=m.useState({aliquota:!1,imponibile:!1,imposta:!1}),[h,D]=m.useState(!0);m.useEffect(()=>{D(!Object.values(r).every(c=>c===!1))},[r]);const f=c=>{const{value:v,name:C,required:x}=c.target;n({...o,[C]:v}),x&&l({...r,[C]:v.toString().length<1})},z=()=>{u(!1),s(o)};return e(O,{children:i(L,{open:b,onClose:()=>u(!1),children:[i($,{children:[e(S,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:o.aliquota,error:r.aliquota,onChange:f}),e(S,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:o.imponibile,error:r.imponibile,onChange:f}),e(S,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:o.imposta,error:r.imposta,onChange:f})]}),e(M,{children:e(T,{disabled:h,onClick:z,children:"salva"})})]})})};function pe(b,u){return async s=>{de.put(`${me.FATTURE}/${b}`,u).then(o=>{s(ne(o.data)),window.location.href=`/app/docfisc/fatture/dettagli/${o.data.id}`}).catch(o=>{s(ae(o.message))})}}const ge=({open:b,handleClose:u,onSubmit:s})=>{const[o,n]=m.useState({data:new Date().toISOString().split("T")[0],importo:0}),[r,l]=m.useState({data:!1,importo:!1}),[h,D]=m.useState(!0);m.useEffect(()=>{D(!Object.values(r).every(c=>c===!1))},[r]);const f=c=>{const{value:v,name:C,required:x}=c.target;n({...o,[C]:v}),x&&l({...r,[C]:v.toString().length<1})},z=()=>{u(!1),s(o)};return e(O,{children:i(L,{open:b,onClose:()=>u(!1),children:[i($,{children:[e(S,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:o.data,error:r.data,onChange:f,type:"date"}),e(S,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:o.importo,error:r.importo,onChange:f})]}),e(M,{children:e(T,{disabled:h,onClick:z,children:"salva"})})]})})},fe=({open:b,handleClose:u,onSubmit:s})=>{const[o,n]=m.useState({data:new Date().toISOString().split("T")[0],importo:0}),[r,l]=m.useState({data:!1,importo:!1}),[h,D]=m.useState(!0);m.useEffect(()=>{D(!Object.values(r).every(c=>c===!1))},[r]);const f=c=>{const{value:v,name:C,required:x}=c.target;n({...o,[C]:v}),x&&l({...r,[C]:v.toString().length<1})},z=()=>{u(!1),s(o)};return e(O,{children:i(L,{open:b,onClose:()=>u(!1),children:[i($,{children:[e(S,{fullWidth:!0,label:"Data Pagamento",name:"data",margin:"normal",value:o.data,error:r.data,onChange:f,type:"date"}),e(S,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:o.importo,error:r.importo,onChange:f})]}),e(M,{children:e(T,{disabled:h,onClick:z,children:"salva"})})]})})},be=({tipiDocumento:b,aziende:u,dettagli:s})=>{const o=G(),[n,r]=m.useState({cedente:s.cedente,committente:s.committente,tipoDocumento:s.tipoDocumento,data:s.data,numero:s.numero,totale:s.totale,reparti:s.reparti,scadenze:s.scadenze,pagamenti:s.pagamenti}),[l,h]=m.useState({cedente:!1,committente:!1,tipoDocumento:!1,data:!1,numero:!1,totale:!1,reparti:!1,scadenze:!1,pagamenti:!1}),[D,f]=m.useState(!1),[z,c]=m.useState(!1),[v,C]=m.useState(!1),[x,N]=m.useState(!0);m.useEffect(()=>{N(!Object.values(l).every(t=>t===!1))},[l]);const H=(t,a,q)=>{r({...n,cedente:a}),h({...l,cedente:E.isEmpty(a)})},U=(t,a,q)=>{r({...n,committente:a}),h({...l,committente:E.isEmpty(a)})},J=(t,a,q)=>{r({...n,tipoDocumento:a}),h({...l,tipoDocumento:E.isEmpty(a)})},P=t=>{const{value:a,name:q,required:te}=t.target;r({...n,[q]:a}),te&&h({...l,[q]:a.toString().length<1})},K=t=>{const a=[...n.reparti,t];r({...n,reparti:a}),h({...l,reparti:a.length<1})},Q=t=>{const a=[...n.reparti];a.splice(t,1),r({...n,reparti:a}),h({...l,reparti:a.length<1})},X=t=>{const a=[...n.scadenze,t];r({...n,scadenze:a}),h({...l,scadenze:a.length<1})},Y=t=>{const a=[...n.scadenze];a.splice(t,1),r({...n,scadenze:a}),h({...l,scadenze:a.length<1})},Z=t=>{const a=[...n.pagamenti,t];r({...n,pagamenti:a})},_=t=>{const a=[...n.pagamenti];a.splice(t,1),r({...n,pagamenti:a})},ee=()=>{const t={cedente:n.cedente,committente:n.committente,tipoDocumento:n.tipoDocumento,data:n.data,numero:n.numero,totale:n.totale,reparti:n.reparti,scadenze:n.scadenze,pagamenti:n.pagamenti};o(pe(s.id,t))};return i(O,{children:[e(g,{mb:3,children:e(F,{variant:"h3",children:"Aggiungi Fattura"})}),e(g,{mb:3,children:e(A,{children:e(g,{p:2,children:i(p,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(p,{item:!0,xs:12,children:e(w,{fullWidth:!0,disablePortal:!0,options:b,getOptionLabel:t=>t.descrizione,value:n.tipoDocumento,isOptionEqualToValue:(t,a)=>t.descrizione===a.descrizione,onChange:J,renderInput:t=>e(S,{...t,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:l.tipoDocumento})})}),e(p,{item:!0,xs:12,sm:6,children:e(w,{fullWidth:!0,disablePortal:!0,options:u,getOptionLabel:t=>t.denominazione,value:n.cedente,isOptionEqualToValue:(t,a)=>t.denominazione===a.denominazione,onChange:H,renderInput:t=>e(S,{...t,label:"Cedente",name:"cedente",required:!0,error:l.cedente})})}),e(p,{item:!0,xs:12,sm:6,children:e(w,{fullWidth:!0,disablePortal:!0,options:u,getOptionLabel:t=>t.denominazione,value:n.committente,isOptionEqualToValue:(t,a)=>t.denominazione===a.denominazione,onChange:U,renderInput:t=>e(S,{...t,label:"Committente",name:"committente",required:!0,error:l.committente})})}),e(p,{item:!0,xs:12,sm:6,children:e(S,{fullWidth:!0,label:"Data",name:"data",value:n.data,error:l.data,onChange:P,type:"date",required:!0})}),e(p,{item:!0,xs:12,sm:6,children:e(S,{fullWidth:!0,label:"Numero",name:"numero",value:n.numero,error:l.numero,onChange:P,required:!0})}),e(p,{item:!0,xs:12,children:e(S,{fullWidth:!0,label:"Totale documento",name:"totale",value:n.totale,error:l.totale,onChange:P,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(g,{mb:3,children:e(A,{children:i(g,{p:2,children:[i(p,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(p,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(p,{item:!0,xs:6,children:e(g,{sx:{textAlign:"right"},children:e(T,{onClick:()=>f(!0),children:"aggiungi"})})})]}),e(g,{mt:2,children:E.isEmpty(n.reparti)?e(R,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):i(j,{children:[e(B,{children:i(I,{children:[e(d,{children:"Aliquota"}),e(d,{children:"Imponibile"}),e(d,{children:"Imposta"}),e(d,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(k,{children:n.reparti.map((t,a)=>i(I,{children:[i(d,{children:["% ",t.aliquota]}),i(d,{children:["€ ",t.imponibile]}),i(d,{children:["€ ",t.imposta]}),e(d,{children:e(V,{color:"error",onClick:()=>Q(a),children:e(y,{})})})]},a))})]})})]})})}),e(g,{mb:3,children:e(A,{children:i(g,{p:2,children:[i(p,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(p,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(p,{item:!0,xs:6,children:e(g,{sx:{textAlign:"right"},children:e(T,{onClick:()=>c(!0),children:"aggiungi"})})})]}),e(g,{mt:2,children:E.isEmpty(n.scadenze)?e(R,{severity:"error",children:"Devi aggiungere almeno una scadenza!"}):i(j,{children:[e(B,{children:i(I,{children:[e(d,{children:"Data"}),e(d,{children:"Importo"}),e(d,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(k,{children:n.scadenze.map((t,a)=>i(I,{children:[e(d,{children:t.data}),i(d,{children:["€ ",t.importo]}),e(d,{children:e(V,{color:"error",onClick:()=>Y(a),children:e(y,{})})})]},a))})]})})]})})}),e(g,{mb:3,children:e(A,{children:i(g,{p:2,children:[i(p,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(p,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Pagamenti"})}),e(p,{item:!0,xs:6,children:e(g,{sx:{textAlign:"right"},children:e(T,{onClick:()=>C(!0),children:"aggiungi"})})})]}),e(g,{mt:2,children:E.isEmpty(n.pagamenti)?e(R,{severity:"warning",children:"Nessun pagamento"}):i(j,{children:[e(B,{children:i(I,{children:[e(d,{children:"Data"}),e(d,{children:"Importo"}),e(d,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(k,{children:n.pagamenti.map((t,a)=>i(I,{children:[e(d,{children:t.data}),i(d,{children:["€ ",t.importo]}),e(d,{children:e(V,{color:"error",onClick:()=>_(a),children:e(y,{})})})]},a))})]})})]})})}),e(he,{open:D,handleClose:f,onSubmit:K}),e(ge,{open:z,handleClose:c,onSubmit:X}),e(fe,{open:v,handleClose:C,onSubmit:Z}),e(re,{disabled:x,handleClick:ee})]})},Ue=()=>{const b=G(),{id:u}=ie(),{dettagli:s,getting:o,getError:n}=W(c=>c.fatture),{list:r,listing:l,listError:h}=W(c=>c.aziende),{list:D,listing:f,listError:z}=W(c=>c.tipiDocFisc);return m.useEffect(()=>{b(se()),b(ce()),u&&b(ue(u))},[u]),o||l||f?e(oe,{}):n||h||z?e(le,{message:"Errore caricamento dati"}):e(be,{dettagli:s,aziende:r,tipiDocumento:D})};export{Ue as default};
