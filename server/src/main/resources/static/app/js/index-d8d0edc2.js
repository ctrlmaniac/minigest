import{R as i,b as l,j as e,aC as j,aD as k,F as w,l as z,ak as H,ac as M,o as O,M as $}from"./index-222da0ba.js";import{g as G}from"./get-92584661.js";import{u as x,a as I,B as f,T as S}from"./hooks-db4dee7a.js";import{a as U,b as V}from"./DialogContent-d1142615.js";import{T as g}from"./TextField-9f2cfd53.js";import{D as L}from"./DialogActions-6a8a3d75.js";import{B}from"./Button-30f411bc.js";import{a as N,E as _}from"./index-c44c1a12.js";import{P as y}from"./Paper-96727556.js";import{G as A}from"./Grid-c9b8ca58.js";import{A as J}from"./Alert-6c557f0c.js";import{T as K,a as T,b as c,c as Q}from"./TableRow-00ec436f.js";import{T as X}from"./TableHead-137e9606.js";import{I as E}from"./IconTrash-628b6ddf.js";import{I as Y}from"./IconButton-8b5a614b.js";import"./useTheme-88693805.js";import"./Modal-821d5a1c.js";import"./utils-50920ebd.js";import"./TransitionGroupContext-58f02f0d.js";import"./Grow-dd1bfbaf.js";import"./List-670810c7.js";import"./createSvgIcon-208d5829.js";import"./ButtonBase-f82ec6e5.js";import"./createReactComponent-d2644421.js";const Z=({open:r,handleClose:n,handleSubmit:d})=>{const[t,s]=i.useState({aliquota:22,totale:0,totaleAnnulli:0,totaleResi:0}),[o,m]=i.useState({aliquota:!1,totale:!1,totaleAnnulli:!1,totaleResi:!1}),p=v=>{const{name:C,value:D,required:q}=v.target;s({...t,[C]:D}),q&&m({...o,[C]:D.length<1})},[h,R]=i.useState(!0);i.useEffect(()=>{R(!Object.values(o).every(v=>v===!1))},[o]);const b=()=>{n(!1),d(t)};return l(U,{open:r,onClose:()=>n(!1),children:[l(V,{children:[e(g,{label:"aliquota",name:"aliquota",value:t.aliquota,error:o.aliquota,fullWidth:!0,required:!0,onChange:p,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale",name:"totale",value:t.totale,error:o.totale,fullWidth:!0,required:!0,onChange:p,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale annulli",name:"totaleAnnulli",value:t.totaleAnnulli,error:o.totaleAnnulli,fullWidth:!0,required:!0,onChange:p,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale resi",name:"totaleResi",value:t.totaleResi,error:o.totaleResi,fullWidth:!0,required:!0,onChange:p,margin:"normal",type:"number",inputProps:{step:.01}})]}),e(L,{children:e(B,{disabled:h,onClick:b,children:"Salva"})})]})};function ee(r,n){return async d=>{N.put(`${_.CHIUSURE_FISCALI}/${r}`,n).then(t=>{d(j(t.data)),window.location.href=`/app/docfisc/chiusure-fiscali/dettagli/${t.data.id}`}).catch(t=>{d(k(t.message))})}}const te=({dettagli:r})=>{const n=x(),[d,t]=i.useState(!1);I(a=>a.negozi);const[s,o]=i.useState({data:r.data,totale:r.totale,numeroDocFisc:r.numeroDocFisc}),[m,p]=i.useState([...r.reparti]),[h,R]=i.useState({data:!1,totale:!1,numeroDocFisc:!1}),b=a=>{const{name:u,value:F,required:W}=a.target;o({...s,[u]:F}),W&&R({...h,[u]:F.length<1})},[v,C]=i.useState(!0);i.useEffect(()=>{const a=!Object.values(h).every(u=>u===!1);C(a||m.length<1)},[h,m]);const D=a=>{p([...m,a])},q=a=>{const u=[...m];u.splice(a,1),p(u)},P=()=>{const a={negozio:r.negozio,...s,reparti:m};n(ee(r==null?void 0:r.id,a))};return l(w,{children:[e(f,{mb:3,children:e(S,{variant:"h3",children:"Aggiungi Chiusura Fiscale"})}),e(f,{mb:3,children:e(y,{children:l(f,{p:2,children:[e(g,{label:"Data",name:"data",value:s.data,error:h.data,fullWidth:!0,required:!0,onChange:b,margin:"normal",type:"date"}),e(g,{label:"Totale",name:"totale",value:s.totale,error:h.totale,fullWidth:!0,required:!0,onChange:b,margin:"normal",type:"number"}),e(g,{label:"Num. D.F.",name:"numeroDocFisc",value:s.numeroDocFisc,error:h.numeroDocFisc,fullWidth:!0,required:!0,onChange:b,margin:"normal",type:"number"})]})})}),e(f,{children:e(y,{children:l(f,{p:2,children:[l(A,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(A,{item:!0,xs:6,children:e(S,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(A,{item:!0,xs:6,children:e(f,{sx:{textAlign:"right"},children:e(B,{onClick:()=>t(!0),children:"aggiungi"})})})]}),e(f,{mt:2,children:z.isEmpty(m)?e(J,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):l(K,{children:[e(X,{children:l(T,{children:[e(c,{children:"Aliquota"}),e(c,{children:"Totale"}),e(c,{children:"Annulli"}),e(c,{children:"Resi"}),e(c,{sx:{width:50},align:"center",children:e(E,{})})]})}),e(Q,{children:m.map((a,u)=>l(T,{children:[l(c,{children:[a.aliquota," %"]}),l(c,{children:[a.totale," €"]}),l(c,{children:[a.totaleAnnulli," €"]}),l(c,{children:[a.totaleResi," €"]}),e(c,{align:"center",children:e(Y,{color:"error",onClick:()=>q(u),children:e(E,{})})})]},u))})]})})]})})}),e(Z,{open:d,handleClose:t,handleSubmit:D}),e(H,{handleClick:P,disabled:v})]})},ye=()=>{const r=x(),{id:n}=M(),{dettagli:d,getting:t,getError:s}=I(o=>o.chiusureFiscali);return i.useEffect(()=>{n&&r(G(n))},[n]),t?e(O,{}):s?e($,{message:s}):e(te,{dettagli:d})};export{ye as default};
