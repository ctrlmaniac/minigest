import{R as o,b as l,j as e,aA as j,aB as w,F as k,l as z,ai as H,aa as O,o as $,C as G}from"./index-67254d02.js";import{g as U}from"./get-091f0d10.js";import{u as x,a as I,B as f,T as S}from"./hooks-fccfb499.js";import{a as V,b as _}from"./DialogContent-14b40355.js";import{T as g}from"./TextField-4add7af0.js";import{D as L}from"./DialogActions-e591b99a.js";import{B}from"./Button-f80334d5.js";import{a as M,E as N}from"./index-c44c1a12.js";import{P as y}from"./Paper-3e81e2e3.js";import{G as A}from"./Grid-92817418.js";import{A as J}from"./Alert-7c7d6f34.js";import{T as K,a as T,b as c,c as Q}from"./TableRow-b83a5f3c.js";import{T as X}from"./TableHead-ce5d8a6b.js";import{I as E}from"./IconTrash-ef31679c.js";import{I as Y}from"./IconButton-3fae5024.js";import"./useTheme-b4ae5703.js";import"./Modal-36c42f6c.js";import"./utils-2b3ff743.js";import"./TransitionGroupContext-9ce3bcfc.js";import"./Grow-de51d2e5.js";import"./List-02219cef.js";import"./createSvgIcon-6b855daf.js";import"./ButtonBase-4000f0af.js";import"./createReactComponent-d33df1ab.js";const Z=({open:r,handleClose:n,handleSubmit:d})=>{const[t,s]=o.useState({aliquota:22,totale:0,totaleAnnulli:0,totaleResi:0}),[i,m]=o.useState({aliquota:!1,totale:!1,totaleAnnulli:!1,totaleResi:!1}),p=C=>{const{name:v,value:D,required:q}=C.target;s({...t,[v]:D}),q&&m({...i,[v]:D.length<1})},[h,R]=o.useState(!0);o.useEffect(()=>{R(!Object.values(i).every(C=>C===!1))},[i]);const b=()=>{n(!1),d(t)};return l(V,{open:r,onClose:()=>n(!1),children:[l(_,{children:[e(g,{label:"aliquota",name:"aliquota",value:t.aliquota,error:i.aliquota,fullWidth:!0,required:!0,onChange:p,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale",name:"totale",value:t.totale,error:i.totale,fullWidth:!0,required:!0,onChange:p,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale annulli",name:"totaleAnnulli",value:t.totaleAnnulli,error:i.totaleAnnulli,fullWidth:!0,required:!0,onChange:p,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale resi",name:"totaleResi",value:t.totaleResi,error:i.totaleResi,fullWidth:!0,required:!0,onChange:p,margin:"normal",type:"number",inputProps:{step:.01}})]}),e(L,{children:e(B,{disabled:h,onClick:b,children:"Salva"})})]})};function ee(r,n){return async d=>{M.put(`${N.CHIUSURE_FISCALI}/${r}`,n).then(t=>{d(j(t.data)),window.location.href=`/app/docfisc/chiusure-fiscali/dettagli/${t.data.id}`}).catch(t=>{d(w(t.message))})}}const te=({dettagli:r})=>{const n=x(),[d,t]=o.useState(!1);I(a=>a.negozi);const[s,i]=o.useState({data:r.data,totale:r.totale,numeroDocFisc:r.numeroDocFisc}),[m,p]=o.useState([...r.reparti]),[h,R]=o.useState({data:!1,totale:!1,numeroDocFisc:!1}),b=a=>{const{name:u,value:F,required:W}=a.target;i({...s,[u]:F}),W&&R({...h,[u]:F.length<1})},[C,v]=o.useState(!0);o.useEffect(()=>{const a=!Object.values(h).every(u=>u===!1);v(a||m.length<1)},[h,m]);const D=a=>{p([...m,a])},q=a=>{const u=[...m];u.splice(a,1),p(u)},P=()=>{const a={negozio:r.negozio,...s,reparti:m};n(ee(r==null?void 0:r.id,a))};return l(k,{children:[e(f,{mb:3,children:e(S,{variant:"h3",children:"Aggiungi Chiusura Fiscale"})}),e(f,{mb:3,children:e(y,{children:l(f,{p:2,children:[e(g,{label:"Data",name:"data",value:s.data,error:h.data,fullWidth:!0,required:!0,onChange:b,margin:"normal",type:"date"}),e(g,{label:"Totale",name:"totale",value:s.totale,error:h.totale,fullWidth:!0,required:!0,onChange:b,margin:"normal",type:"number"}),e(g,{label:"Num. D.F.",name:"numeroDocFisc",value:s.numeroDocFisc,error:h.numeroDocFisc,fullWidth:!0,required:!0,onChange:b,margin:"normal",type:"number"})]})})}),e(f,{children:e(y,{children:l(f,{p:2,children:[l(A,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(A,{item:!0,xs:6,children:e(S,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(A,{item:!0,xs:6,children:e(f,{sx:{textAlign:"right"},children:e(B,{onClick:()=>t(!0),children:"aggiungi"})})})]}),e(f,{mt:2,children:z.isEmpty(m)?e(J,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):l(K,{children:[e(X,{children:l(T,{children:[e(c,{children:"Aliquota"}),e(c,{children:"Totale"}),e(c,{children:"Annulli"}),e(c,{children:"Resi"}),e(c,{sx:{width:50},align:"center",children:e(E,{})})]})}),e(Q,{children:m.map((a,u)=>l(T,{children:[l(c,{children:[a.aliquota," %"]}),l(c,{children:[a.totale," €"]}),l(c,{children:[a.totaleAnnulli," €"]}),l(c,{children:[a.totaleResi," €"]}),e(c,{align:"center",children:e(Y,{color:"error",onClick:()=>q(u),children:e(E,{})})})]},u))})]})})]})})}),e(Z,{open:d,handleClose:t,handleSubmit:D}),e(H,{handleClick:P,disabled:C})]})},ye=()=>{const r=x(),{id:n}=O(),{dettagli:d,getting:t,getError:s}=I(i=>i.chiusureFiscali);return o.useEffect(()=>{n&&r(U(n))},[n]),t?e($,{}):s?e(G,{message:s}):e(te,{dettagli:d})};export{ye as default};
