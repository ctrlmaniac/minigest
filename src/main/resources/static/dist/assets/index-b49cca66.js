import{R as m,j as e,F as j,a as o,aR as Z,aS as _,N as I,a8 as ee}from"./index-f45c03a1.js";import{E as te}from"./ErrorScreen-23109fc3.js";import{L as re}from"./LoadingScreen-7795ebdd.js";import{l as ne}from"./list-7499e7e0.js";import{l as ae}from"./list-f9039c5e.js";import{u as V,a as A}from"./hooks-71074923.js";import{S as ie}from"./SaveFab-bde2bcc6.js";import{a as $,b as G}from"./DialogContent-c6b80c7a.js";import{T as S}from"./TextField-2a8b6e79.js";import{D as N}from"./DialogActions-4298e2d3.js";import{B as y}from"./Button-0977364e.js";import{a as oe,E as le}from"./index-e540bbee.js";import{B as b,T as O}from"./Box-3112786e.js";import{P as R}from"./Paper-c542b63c.js";import{G as h}from"./Grid-656ee9be.js";import{A as W}from"./Autocomplete-63b134cc.js";import{A as w,I as B}from"./Alert-9ab8b305.js";import{T as k,a as T,b as p,c as L}from"./TableRow-aa552d5a.js";import{T as P}from"./TableHead-f12ffb5d.js";import{I as q}from"./IconTrash-34d4add2.js";import{g as se}from"./get-4ef54a25.js";import"./Splash-c0a4ca1f.js";import"./Container-b2c8bae1.js";import"./Fab-8a5b0f7e.js";import"./ButtonBase-07c320ab.js";import"./createReactComponent-19830811.js";import"./useTheme-7ac3100d.js";import"./Modal-6c34c1a4.js";import"./utils-856da27c.js";import"./Grow-46dd7ada.js";import"./List-cc96011b.js";import"./createSvgIcon-5f7bcaef.js";import"./Popper-6fbc53ae.js";import"./ListSubheader-8acb441f.js";const ce=({open:f,handleClose:d,onSubmit:s})=>{const[l,n]=m.useState({aliquota:22,imponibile:0,imposta:0}),[a,i]=m.useState({aliquota:!1,imponibile:!1,imposta:!1}),[u,C]=m.useState(!0);m.useEffect(()=>{C(!Object.values(a).every(c=>c===!1))},[a]);const g=c=>{const{value:D,name:z,required:E}=c.target;n({...l,[z]:D}),E&&i({...a,[z]:D.toString().length<1})},v=()=>{d(!1),s(l)};return e(j,{children:o($,{open:f,onClose:()=>d(!1),children:[o(G,{children:[e(S,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:l.aliquota,error:a.aliquota,onChange:g}),e(S,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:l.imponibile,error:a.imponibile,onChange:g}),e(S,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:l.imposta,error:a.imposta,onChange:g})]}),e(N,{children:e(y,{disabled:u,onClick:v,children:"salva"})})]})})};function me(f,d){return async s=>{oe.put(`${le.FATTURE}/${f}`,d).then(l=>{s(Z(l.data)),window.location.href=`/app/docfisc/fatture/dettagli/${l.data.id}`}).catch(l=>{s(_(l.message))})}}const de=({open:f,handleClose:d,onSubmit:s})=>{const[l,n]=m.useState({data:new Date().toISOString().split("T")[0],importo:0}),[a,i]=m.useState({data:!1,importo:!1}),[u,C]=m.useState(!0);m.useEffect(()=>{C(!Object.values(a).every(c=>c===!1))},[a]);const g=c=>{const{value:D,name:z,required:E}=c.target;n({...l,[z]:D}),E&&i({...a,[z]:D.toString().length<1})},v=()=>{d(!1),s(l)};return e(j,{children:o($,{open:f,onClose:()=>d(!1),children:[o(G,{children:[e(S,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:l.data,error:a.data,onChange:g,type:"date"}),e(S,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:l.importo,error:a.importo,onChange:g})]}),e(N,{children:e(y,{disabled:u,onClick:v,children:"salva"})})]})})},ue=({tipiDocumento:f,aziende:d,dettagli:s})=>{const l=V(),[n,a]=m.useState({cedente:s.cedente,committente:s.committente,tipoDocumento:s.tipoDocumento,data:s.data,numero:s.numero,totale:s.totale,reparti:s.reparti,scadenze:s.scadenze}),[i,u]=m.useState({cedente:!1,committente:!1,tipoDocumento:!1,data:!1,numero:!1,totale:!1,reparti:!1,scadenze:!1}),[C,g]=m.useState(!1),[v,c]=m.useState(!1),[D,z]=m.useState(!0);m.useEffect(()=>{z(!Object.values(i).every(t=>t===!1))},[i]);const E=(t,r,x)=>{a({...n,cedente:r}),u({...i,cedente:I.isEmpty(r)})},H=(t,r,x)=>{a({...n,committente:r}),u({...i,committente:I.isEmpty(r)})},M=(t,r,x)=>{a({...n,tipoDocumento:r}),u({...i,tipoDocumento:I.isEmpty(r)})},F=t=>{const{value:r,name:x,required:Y}=t.target;a({...n,[x]:r}),Y&&u({...i,[x]:r.toString().length<1})},U=t=>{const r=[...n.reparti,t];a({...n,reparti:r}),u({...i,reparti:r.length<1})},J=t=>{const r=[...n.reparti];r.splice(t,1),a({...n,reparti:r}),u({...i,reparti:r.length<1})},K=t=>{const r=[...n.scadenze,t];a({...n,scadenze:r}),u({...i,scadenze:r.length<1})},Q=t=>{const r=[...n.scadenze];r.splice(t,1),a({...n,scadenze:r}),u({...i,scadenze:r.length<1})},X=()=>{const t={cedente:n.cedente,committente:n.committente,tipoDocumento:n.tipoDocumento,data:n.data,numero:n.numero,totale:n.totale,reparti:n.reparti,scadenze:n.scadenze};l(me(s.id,t))};return o(j,{children:[e(b,{mb:3,children:e(O,{variant:"h3",children:"Aggiungi Fattura"})}),e(b,{mb:3,children:e(R,{children:e(b,{p:2,children:o(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(h,{item:!0,xs:12,children:e(W,{fullWidth:!0,disablePortal:!0,options:f,getOptionLabel:t=>t.descrizione,value:n.tipoDocumento,isOptionEqualToValue:(t,r)=>t.descrizione===r.descrizione,onChange:M,renderInput:t=>e(S,{...t,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:i.tipoDocumento})})}),e(h,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:d,getOptionLabel:t=>t.denominazione,value:n.cedente,isOptionEqualToValue:(t,r)=>t.denominazione===r.denominazione,onChange:E,renderInput:t=>e(S,{...t,label:"Cedente",name:"cedente",required:!0,error:i.cedente})})}),e(h,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:d,getOptionLabel:t=>t.denominazione,value:n.committente,isOptionEqualToValue:(t,r)=>t.denominazione===r.denominazione,onChange:H,renderInput:t=>e(S,{...t,label:"Committente",name:"committente",required:!0,error:i.committente})})}),e(h,{item:!0,xs:12,sm:6,children:e(S,{fullWidth:!0,label:"Data",name:"data",value:n.data,error:i.data,onChange:F,type:"date",required:!0})}),e(h,{item:!0,xs:12,sm:6,children:e(S,{fullWidth:!0,label:"Numero",name:"numero",value:n.numero,error:i.numero,onChange:F,required:!0})}),e(h,{item:!0,xs:12,children:e(S,{fullWidth:!0,label:"Totale documento",name:"totale",value:n.totale,error:i.totale,onChange:F,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(b,{mb:3,children:e(R,{children:o(b,{p:2,children:[o(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(h,{item:!0,xs:6,children:e(O,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(h,{item:!0,xs:6,children:e(b,{sx:{textAlign:"right"},children:e(y,{onClick:()=>g(!0),children:"aggiungi"})})})]}),e(b,{mt:2,children:I.isEmpty(n.reparti)?e(w,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):o(k,{children:[e(P,{children:o(T,{children:[e(p,{children:"Aliquota"}),e(p,{children:"Imponibile"}),e(p,{children:"Imposta"}),e(p,{sx:{width:50},align:"center",children:e(q,{})})]})}),e(L,{children:n.reparti.map((t,r)=>o(T,{children:[o(p,{children:["% ",t.aliquota]}),o(p,{children:["€ ",t.imponibile]}),o(p,{children:["€ ",t.imposta]}),e(p,{children:e(B,{color:"error",onClick:()=>J(r),children:e(q,{})})})]},r))})]})})]})})}),e(b,{mb:3,children:e(R,{children:o(b,{p:2,children:[o(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(h,{item:!0,xs:6,children:e(O,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(h,{item:!0,xs:6,children:e(b,{sx:{textAlign:"right"},children:e(y,{onClick:()=>c(!0),children:"aggiungi"})})})]}),e(b,{mt:2,children:I.isEmpty(n.scadenze)?e(w,{severity:"error",children:"Devi aggiungere almeno una scadenza!"}):o(k,{children:[e(P,{children:o(T,{children:[e(p,{children:"Data"}),e(p,{children:"Importo"}),e(p,{sx:{width:50},align:"center",children:e(q,{})})]})}),e(L,{children:n.scadenze.map((t,r)=>o(T,{children:[e(p,{children:t.data}),o(p,{children:["€ ",t.importo]}),e(p,{children:e(B,{color:"error",onClick:()=>Q(r),children:e(q,{})})})]},r))})]})})]})})}),e(ce,{open:C,handleClose:g,onSubmit:U}),e(de,{open:v,handleClose:c,onSubmit:K}),e(ie,{disabled:D,handleClick:X})]})},Je=()=>{const f=V(),{id:d}=ee(),{dettagli:s,getting:l,getError:n}=A(c=>c.fatture),{list:a,listing:i,listError:u}=A(c=>c.aziende),{list:C,listing:g,listError:v}=A(c=>c.tipiDocFisc);return m.useEffect(()=>{f(ne()),f(ae()),d&&f(se(d))},[d]),l||i||g?e(re,{}):n||u||v?e(te,{message:"Errore caricamento dati"}):e(ue,{dettagli:s,aziende:a,tipiDocumento:C})};export{Je as default};
