import{R as l,j as e,F as O,a as i,aL as te,aM as ne,L as I,B as m,P as re}from"./index-761b4989.js";import{l as ae}from"./list-6cc63ed1.js";import{l as ie}from"./list-ba451822.js";import{u as H,a as G}from"./hooks-9000e4c8.js";import{S as oe}from"./SaveFab-161b3a92.js";import{a as V,b as L}from"./DialogContent-dd0e4384.js";import{T as f}from"./TextField-294b3173.js";import{D as $}from"./DialogActions-7d88a1ae.js";import{B as E}from"./Button-bf9e9fee.js";import{a as le,E as se}from"./index-30e337fd.js";import{T as F}from"./Typography-4033f764.js";import{P as A}from"./Paper-1026d494.js";import{G as d}from"./Grid-c7d0a2fe.js";import{A as P}from"./Autocomplete-676b98d3.js";import{A as W,I as j}from"./Alert-caf42b59.js";import{T as k,a as y,b as o,c as R}from"./TableRow-f3e30aef.js";import{T as B}from"./TableHead-7c58f24d.js";import{I as T}from"./IconTrash-7b2f8fcb.js";import"./Container-e078e984.js";import"./Fab-0c52d3ca.js";import"./ButtonBase-242e16e9.js";import"./createReactComponent-62a25815.js";import"./useTheme-167c9bfa.js";import"./Modal-c33af6cc.js";import"./utils-b42c4e0c.js";import"./Grow-3595db16.js";import"./List-ff5ffe2c.js";import"./createSvgIcon-1320d625.js";import"./Popper-533f8ce2.js";import"./ListSubheader-c2ea56a9.js";const ce=({open:p,handleClose:c,onSubmit:u})=>{const[t,s]=l.useState({aliquota:22,imponibile:0,imposta:0}),[a,h]=l.useState({aliquota:!1,imponibile:!1,imposta:!1}),[z,v]=l.useState(!0);l.useEffect(()=>{v(!Object.values(a).every(g=>g===!1))},[a]);const b=g=>{const{value:S,name:C,required:x}=g.target;s({...t,[C]:S}),x&&h({...a,[C]:S.toString().length<1})},D=()=>{c(!1),u(t)};return e(O,{children:i(V,{open:p,onClose:()=>c(!1),children:[i(L,{children:[e(f,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:t.aliquota,error:a.aliquota,onChange:b}),e(f,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:t.imponibile,error:a.imponibile,onChange:b}),e(f,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:t.imposta,error:a.imposta,onChange:b})]}),e($,{children:e(E,{disabled:z,onClick:D,children:"salva"})})]})})};function de(p){return async c=>{le.post(`${se.FATTURE}`,p).then(u=>{c(te(u.data)),window.location.href=`/app/docfisc/fatture/dettagli/${u.data.id}`}).catch(u=>{c(ne(u.message))})}}const me=({open:p,handleClose:c,onSubmit:u})=>{const[t,s]=l.useState({data:new Date().toISOString().split("T")[0],importo:0}),[a,h]=l.useState({data:!1,importo:!1}),[z,v]=l.useState(!0);l.useEffect(()=>{v(!Object.values(a).every(g=>g===!1))},[a]);const b=g=>{const{value:S,name:C,required:x}=g.target;s({...t,[C]:S}),x&&h({...a,[C]:S.toString().length<1})},D=()=>{c(!1),u(t)};return e(O,{children:i(V,{open:p,onClose:()=>c(!1),children:[i(L,{children:[e(f,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:t.data,error:a.data,onChange:b,type:"date"}),e(f,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:t.importo,error:a.importo,onChange:b})]}),e($,{children:e(E,{disabled:z,onClick:D,children:"salva"})})]})})},ue=({open:p,handleClose:c,onSubmit:u})=>{const[t,s]=l.useState({data:new Date().toISOString().split("T")[0],importo:0}),[a,h]=l.useState({data:!1,importo:!1}),[z,v]=l.useState(!0);l.useEffect(()=>{v(!Object.values(a).every(g=>g===!1))},[a]);const b=g=>{const{value:S,name:C,required:x}=g.target;s({...t,[C]:S}),x&&h({...a,[C]:S.toString().length<1})},D=()=>{c(!1),u(t)};return e(O,{children:i(V,{open:p,onClose:()=>c(!1),children:[i(L,{children:[e(f,{fullWidth:!0,label:"Data Pagamento",name:"data",margin:"normal",value:t.data,error:a.data,onChange:b,type:"date"}),e(f,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:t.importo,error:a.importo,onChange:b})]}),e($,{children:e(E,{disabled:z,onClick:D,children:"salva"})})]})})},he=({tipiDocumento:p,aziende:c})=>{const u=H(),[t,s]=l.useState({cedente:null,committente:null,tipoDocumento:I.find(p,["descrizione","fattura"])||null,data:new Date().toISOString().split("T")[0],numero:"",totale:0,reparti:[],scadenze:[],pagamenti:[]}),[a,h]=l.useState({cedente:!0,committente:!0,tipoDocumento:!1,data:!1,numero:!0,totale:!1,reparti:!0,scadenze:!0,pagamenti:!1}),[z,v]=l.useState(!1),[b,D]=l.useState(!1),[g,S]=l.useState(!1),[C,x]=l.useState(!0);l.useEffect(()=>{x(!Object.values(a).every(n=>n===!1))},[a]);const M=(n,r,q)=>{s({...t,cedente:r}),h({...a,cedente:I.isEmpty(r)})},N=(n,r,q)=>{s({...t,committente:r}),h({...a,committente:I.isEmpty(r)})},Q=(n,r,q)=>{s({...t,tipoDocumento:r}),h({...a,tipoDocumento:I.isEmpty(r)})},w=n=>{const{value:r,name:q,required:ee}=n.target;s({...t,[q]:r}),ee&&h({...a,[q]:r.length<1})},U=n=>{const r=[...t.reparti,n];s({...t,reparti:r}),h({...a,reparti:r.length<1})},J=n=>{const r=[...t.reparti];r.splice(n,1),s({...t,reparti:r}),h({...a,reparti:r.length<1})},K=n=>{const r=[...t.scadenze,n];s({...t,scadenze:r}),h({...a,scadenze:r.length<1})},X=n=>{const r=[...t.scadenze];r.splice(n,1),s({...t,scadenze:r}),h({...a,scadenze:r.length<1})},Y=n=>{const r=[...t.pagamenti,n];s({...t,pagamenti:r})},Z=n=>{const r=[...t.pagamenti];r.splice(n,1),s({...t,pagamenti:r})},_=()=>{const n={cedente:t.cedente,committente:t.committente,tipoDocumento:t.tipoDocumento,data:t.data,numero:t.numero,totale:t.totale,reparti:t.reparti,scadenze:t.scadenze,pagamenti:t.pagamenti};u(de(n))};return i(O,{children:[e(m,{mb:3,children:e(F,{variant:"h3",children:"Aggiungi Fattura"})}),e(m,{mb:3,children:e(A,{children:e(m,{p:2,children:i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(d,{item:!0,xs:12,children:e(P,{fullWidth:!0,disablePortal:!0,options:p,getOptionLabel:n=>n.descrizione,value:t.tipoDocumento,isOptionEqualToValue:(n,r)=>n.descrizione===r.descrizione,onChange:Q,renderInput:n=>e(f,{...n,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:a.tipoDocumento})})}),e(d,{item:!0,xs:12,sm:6,children:e(P,{fullWidth:!0,disablePortal:!0,options:c,getOptionLabel:n=>n.denominazione,value:t.cedente,isOptionEqualToValue:(n,r)=>n.denominazione===r.denominazione,onChange:M,renderInput:n=>e(f,{...n,label:"Cedente",name:"cedente",required:!0,error:a.cedente})})}),e(d,{item:!0,xs:12,sm:6,children:e(P,{fullWidth:!0,disablePortal:!0,options:c,getOptionLabel:n=>n.denominazione,value:t.committente,isOptionEqualToValue:(n,r)=>n.denominazione===r.denominazione,onChange:N,renderInput:n=>e(f,{...n,label:"Committente",name:"committente",required:!0,error:a.committente})})}),e(d,{item:!0,xs:12,sm:6,children:e(f,{fullWidth:!0,label:"Data",name:"data",value:t.data,error:a.data,onChange:w,type:"date",required:!0})}),e(d,{item:!0,xs:12,sm:6,children:e(f,{fullWidth:!0,label:"Numero",name:"numero",value:t.numero,error:a.numero,onChange:w,required:!0})}),e(d,{item:!0,xs:12,children:e(f,{fullWidth:!0,label:"Totale documento",name:"totale",value:t.totale,error:a.totale,onChange:w,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(m,{mb:3,children:e(A,{children:i(m,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(d,{item:!0,xs:6,children:e(m,{sx:{textAlign:"right"},children:e(E,{onClick:()=>v(!0),children:"aggiungi"})})})]}),e(m,{mt:2,children:I.isEmpty(t.reparti)?e(W,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):i(k,{children:[e(B,{children:i(y,{children:[e(o,{children:"Aliquota"}),e(o,{children:"Imponibile"}),e(o,{children:"Imposta"}),e(o,{sx:{width:50},align:"center",children:e(T,{})})]})}),e(R,{children:t.reparti.map((n,r)=>i(y,{children:[i(o,{children:["% ",n.aliquota]}),i(o,{children:["€ ",n.imponibile]}),i(o,{children:["€ ",n.imposta]}),e(o,{children:e(j,{color:"error",onClick:()=>J(r),children:e(T,{})})})]},r))})]})})]})})}),e(m,{mb:3,children:e(A,{children:i(m,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(d,{item:!0,xs:6,children:e(m,{sx:{textAlign:"right"},children:e(E,{onClick:()=>D(!0),children:"aggiungi"})})})]}),e(m,{mt:2,children:I.isEmpty(t.scadenze)?e(W,{severity:"error",children:"Devi aggiungere almeno una scadenza!"}):i(k,{children:[e(B,{children:i(y,{children:[e(o,{children:"Data"}),e(o,{children:"Importo"}),e(o,{sx:{width:50},align:"center",children:e(T,{})})]})}),e(R,{children:t.scadenze.map((n,r)=>i(y,{children:[e(o,{children:n.data}),i(o,{children:["€ ",n.importo]}),e(o,{children:e(j,{color:"error",onClick:()=>X(r),children:e(T,{})})})]},r))})]})})]})})}),e(m,{children:e(A,{children:i(m,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Pagamenti"})}),e(d,{item:!0,xs:6,children:e(m,{sx:{textAlign:"right"},children:e(E,{onClick:()=>S(!0),children:"aggiungi"})})})]}),e(m,{mt:2,children:I.isEmpty(t.pagamenti)?e(W,{severity:"warning",children:"Questa fattura non ha pagamenti registrati"}):i(k,{children:[e(B,{children:i(y,{children:[e(o,{children:"Data"}),e(o,{children:"Importo"}),e(o,{sx:{width:50},align:"center",children:e(T,{})})]})}),e(R,{children:t.pagamenti.map((n,r)=>i(y,{children:[e(o,{children:n.data}),i(o,{children:["€ ",n.importo]}),e(o,{children:e(j,{color:"error",onClick:()=>Z(r),children:e(T,{})})})]},r))})]})})]})})}),e(ce,{open:z,handleClose:v,onSubmit:U}),e(me,{open:b,handleClose:D,onSubmit:K}),e(ue,{open:g,handleClose:S,onSubmit:Y}),e(oe,{disabled:C,handleClick:_})]})},Me=()=>{const p=H(),{list:c,listing:u}=G(a=>a.aziende),{list:t,listing:s}=G(a=>a.tipiDocFisc);return l.useEffect(()=>{p(ae()),p(ie())},[]),u||s?e(re,{}):e(he,{aziende:c,tipiDocumento:t})};export{Me as default};
