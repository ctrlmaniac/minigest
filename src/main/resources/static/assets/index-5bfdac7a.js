import{R as o,j as e,F as w,a as i,aK as Y,aL as Z,N as z}from"./index-f45c03a1.js";import{L as _}from"./LoadingScreen-7795ebdd.js";import{l as ee}from"./list-7499e7e0.js";import{l as te}from"./list-f9039c5e.js";import{u as P,a as R}from"./hooks-71074923.js";import{S as re}from"./SaveFab-bde2bcc6.js";import{a as $,b as G}from"./DialogContent-c6b80c7a.js";import{T as g}from"./TextField-2a8b6e79.js";import{D as N}from"./DialogActions-4298e2d3.js";import{B as E}from"./Button-0977364e.js";import{a as ne,E as ae}from"./index-e540bbee.js";import{B as h,T as A}from"./Box-3112786e.js";import{P as O}from"./Paper-c542b63c.js";import{G as d}from"./Grid-656ee9be.js";import{A as W}from"./Autocomplete-63b134cc.js";import{A as j,I as B}from"./Alert-9ab8b305.js";import{T as k,a as q,b as s,c as L}from"./TableRow-aa552d5a.js";import{T as V}from"./TableHead-f12ffb5d.js";import{I as y}from"./IconTrash-34d4add2.js";import"./Splash-c0a4ca1f.js";import"./Container-b2c8bae1.js";import"./Fab-8a5b0f7e.js";import"./ButtonBase-07c320ab.js";import"./createReactComponent-19830811.js";import"./useTheme-7ac3100d.js";import"./Modal-6c34c1a4.js";import"./utils-856da27c.js";import"./Grow-46dd7ada.js";import"./List-cc96011b.js";import"./createSvgIcon-5f7bcaef.js";import"./Popper-6fbc53ae.js";import"./ListSubheader-8acb441f.js";const ie=({open:p,handleClose:c,onSubmit:m})=>{const[t,l]=o.useState({aliquota:22,imponibile:0,imposta:0}),[a,u]=o.useState({aliquota:!1,imponibile:!1,imposta:!1}),[x,v]=o.useState(!0);o.useEffect(()=>{v(!Object.values(a).every(f=>f===!1))},[a]);const b=f=>{const{value:S,name:C,required:I}=f.target;l({...t,[C]:S}),I&&u({...a,[C]:S.toString().length<1})},D=()=>{c(!1),m(t)};return e(w,{children:i($,{open:p,onClose:()=>c(!1),children:[i(G,{children:[e(g,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:t.aliquota,error:a.aliquota,onChange:b}),e(g,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:t.imponibile,error:a.imponibile,onChange:b}),e(g,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:t.imposta,error:a.imposta,onChange:b})]}),e(N,{children:e(E,{disabled:x,onClick:D,children:"salva"})})]})})};function oe(p){return async c=>{ne.post(`${ae.FATTURE}`,p).then(m=>{c(Y(m.data)),window.location.href=`/app/docfisc/fatture/dettagli/${m.data.id}`}).catch(m=>{c(Z(m.message))})}}const le=({open:p,handleClose:c,onSubmit:m})=>{const[t,l]=o.useState({data:new Date().toISOString().split("T")[0],importo:0}),[a,u]=o.useState({data:!1,importo:!1}),[x,v]=o.useState(!0);o.useEffect(()=>{v(!Object.values(a).every(f=>f===!1))},[a]);const b=f=>{const{value:S,name:C,required:I}=f.target;l({...t,[C]:S}),I&&u({...a,[C]:S.toString().length<1})},D=()=>{c(!1),m(t)};return e(w,{children:i($,{open:p,onClose:()=>c(!1),children:[i(G,{children:[e(g,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:t.data,error:a.data,onChange:b,type:"date"}),e(g,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:t.importo,error:a.importo,onChange:b})]}),e(N,{children:e(E,{disabled:x,onClick:D,children:"salva"})})]})})},se=({tipiDocumento:p,aziende:c})=>{const m=P(),[t,l]=o.useState({cedente:null,committente:null,tipoDocumento:z.find(p,["descrizione","fattura"])||null,data:new Date().toISOString().split("T")[0],numero:"",totale:0,reparti:[],scadenze:[]}),[a,u]=o.useState({cedente:!0,committente:!0,tipoDocumento:!1,data:!1,numero:!0,totale:!1,reparti:!0,scadenze:!0}),[x,v]=o.useState(!1),[b,D]=o.useState(!1),[f,S]=o.useState(!0);o.useEffect(()=>{S(!Object.values(a).every(r=>r===!1))},[a]);const C=(r,n,T)=>{l({...t,cedente:n}),u({...a,cedente:z.isEmpty(n)})},I=(r,n,T)=>{l({...t,committente:n}),u({...a,committente:z.isEmpty(n)})},H=(r,n,T)=>{l({...t,tipoDocumento:n}),u({...a,tipoDocumento:z.isEmpty(n)})},F=r=>{const{value:n,name:T,required:X}=r.target;l({...t,[T]:n}),X&&u({...a,[T]:n.length<1})},K=r=>{const n=[...t.reparti,r];l({...t,reparti:n}),u({...a,reparti:n.length<1})},U=r=>{const n=[...t.reparti];n.splice(r,1),l({...t,reparti:n}),u({...a,reparti:n.length<1})},J=r=>{const n=[...t.scadenze,r];l({...t,scadenze:n}),u({...a,scadenze:n.length<1})},M=r=>{const n=[...t.scadenze];n.splice(r,1),l({...t,scadenze:n}),u({...a,scadenze:n.length<1})},Q=()=>{const r={cedente:t.cedente,committente:t.committente,tipoDocumento:t.tipoDocumento,data:t.data,numero:t.numero,totale:t.totale,reparti:t.reparti,scadenze:t.scadenze};m(oe(r))};return i(w,{children:[e(h,{mb:3,children:e(A,{variant:"h3",children:"Aggiungi Fattura"})}),e(h,{mb:3,children:e(O,{children:e(h,{p:2,children:i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(d,{item:!0,xs:12,children:e(W,{fullWidth:!0,disablePortal:!0,options:p,getOptionLabel:r=>r.descrizione,value:t.tipoDocumento,isOptionEqualToValue:(r,n)=>r.descrizione===n.descrizione,onChange:H,renderInput:r=>e(g,{...r,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:a.tipoDocumento})})}),e(d,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:c,getOptionLabel:r=>r.denominazione,value:t.cedente,isOptionEqualToValue:(r,n)=>r.denominazione===n.denominazione,onChange:C,renderInput:r=>e(g,{...r,label:"Cedente",name:"cedente",required:!0,error:a.cedente})})}),e(d,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:c,getOptionLabel:r=>r.denominazione,value:t.committente,isOptionEqualToValue:(r,n)=>r.denominazione===n.denominazione,onChange:I,renderInput:r=>e(g,{...r,label:"Committente",name:"committente",required:!0,error:a.committente})})}),e(d,{item:!0,xs:12,sm:6,children:e(g,{fullWidth:!0,label:"Data",name:"data",value:t.data,error:a.data,onChange:F,type:"date",required:!0})}),e(d,{item:!0,xs:12,sm:6,children:e(g,{fullWidth:!0,label:"Numero",name:"numero",value:t.numero,error:a.numero,onChange:F,required:!0})}),e(d,{item:!0,xs:12,children:e(g,{fullWidth:!0,label:"Totale documento",name:"totale",value:t.totale,error:a.totale,onChange:F,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(h,{mb:3,children:e(O,{children:i(h,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(A,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(d,{item:!0,xs:6,children:e(h,{sx:{textAlign:"right"},children:e(E,{onClick:()=>v(!0),children:"aggiungi"})})})]}),e(h,{mt:2,children:z.isEmpty(t.reparti)?e(j,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):i(k,{children:[e(V,{children:i(q,{children:[e(s,{children:"Aliquota"}),e(s,{children:"Imponibile"}),e(s,{children:"Imposta"}),e(s,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(L,{children:t.reparti.map((r,n)=>i(q,{children:[i(s,{children:["% ",r.aliquota]}),i(s,{children:["€ ",r.imponibile]}),i(s,{children:["€ ",r.imposta]}),e(s,{children:e(B,{color:"error",onClick:()=>U(n),children:e(y,{})})})]},n))})]})})]})})}),e(h,{children:e(O,{children:i(h,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(A,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(d,{item:!0,xs:6,children:e(h,{sx:{textAlign:"right"},children:e(E,{onClick:()=>D(!0),children:"aggiungi"})})})]}),e(h,{mt:2,children:z.isEmpty(t.scadenze)?e(j,{severity:"error",children:"Devi aggiungere almeno una scadenza!"}):i(k,{children:[e(V,{children:i(q,{children:[e(s,{children:"Data"}),e(s,{children:"Importo"}),e(s,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(L,{children:t.scadenze.map((r,n)=>i(q,{children:[e(s,{children:r.data}),i(s,{children:["€ ",r.importo]}),e(s,{children:e(B,{color:"error",onClick:()=>M(n),children:e(y,{})})})]},n))})]})})]})})}),e(ie,{open:x,handleClose:v,onSubmit:K}),e(le,{open:b,handleClose:D,onSubmit:J}),e(re,{disabled:f,handleClick:Q})]})},$e=()=>{const p=P(),{list:c,listing:m}=R(a=>a.aziende),{list:t,listing:l}=R(a=>a.tipiDocFisc);return o.useEffect(()=>{p(ee()),p(te())},[]),m||l?e(_,{}):e(se,{aziende:c,tipiDocumento:t})};export{$e as default};
