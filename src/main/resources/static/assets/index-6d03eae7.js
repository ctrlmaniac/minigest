import{R as m,j as e,F as j,a as o,aQ as Z,aR as _,B as b,L as I,a7 as ee,P as te}from"./index-10c94bff.js";import{E as re}from"./ErrorScreen-5eddfcdb.js";import{l as ne}from"./list-6b4c632a.js";import{l as ae}from"./list-8d22e690.js";import{u as V,a as A}from"./hooks-9397b445.js";import{S as ie}from"./SaveFab-de76f147.js";import{a as $,b as G}from"./DialogContent-87c63409.js";import{T as S}from"./TextField-eb3a3c5b.js";import{D as H}from"./DialogActions-81047c9c.js";import{B as y}from"./Button-b0fe3115.js";import{a as oe,E as le}from"./index-e540bbee.js";import{T as O}from"./Typography-95a1612a.js";import{P as R}from"./Paper-46a58f5a.js";import{G as h}from"./Grid-d41e33d5.js";import{A as W}from"./Autocomplete-52c1153e.js";import{A as w,I as B}from"./Alert-19648b22.js";import{T as P,a as T,b as p,c as k}from"./TableRow-ea5ae3c9.js";import{T as L}from"./TableHead-3cc55543.js";import{I as q}from"./IconTrash-f0f1451c.js";import{g as se}from"./get-7f9d833c.js";import"./Container-bd6f4fdc.js";import"./Fab-f0961ac3.js";import"./ButtonBase-6e0e1411.js";import"./createReactComponent-ad886392.js";import"./useTheme-75ea811f.js";import"./Modal-2991f9ad.js";import"./utils-b32b3a94.js";import"./Grow-0fe9c25b.js";import"./List-b82d4e7d.js";import"./createSvgIcon-46abf9a7.js";import"./Popper-632739ff.js";import"./ListSubheader-7fb80be5.js";const ce=({open:f,handleClose:d,onSubmit:s})=>{const[l,n]=m.useState({aliquota:22,imponibile:0,imposta:0}),[a,i]=m.useState({aliquota:!1,imponibile:!1,imposta:!1}),[u,C]=m.useState(!0);m.useEffect(()=>{C(!Object.values(a).every(c=>c===!1))},[a]);const g=c=>{const{value:D,name:z,required:E}=c.target;n({...l,[z]:D}),E&&i({...a,[z]:D.toString().length<1})},v=()=>{d(!1),s(l)};return e(j,{children:o($,{open:f,onClose:()=>d(!1),children:[o(G,{children:[e(S,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:l.aliquota,error:a.aliquota,onChange:g}),e(S,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:l.imponibile,error:a.imponibile,onChange:g}),e(S,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:l.imposta,error:a.imposta,onChange:g})]}),e(H,{children:e(y,{disabled:u,onClick:v,children:"salva"})})]})})};function me(f,d){return async s=>{oe.put(`${le.FATTURE}/${f}`,d).then(l=>{s(Z(l.data)),window.location.href=`/app/docfisc/fatture/dettagli/${l.data.id}`}).catch(l=>{s(_(l.message))})}}const de=({open:f,handleClose:d,onSubmit:s})=>{const[l,n]=m.useState({data:new Date().toISOString().split("T")[0],importo:0}),[a,i]=m.useState({data:!1,importo:!1}),[u,C]=m.useState(!0);m.useEffect(()=>{C(!Object.values(a).every(c=>c===!1))},[a]);const g=c=>{const{value:D,name:z,required:E}=c.target;n({...l,[z]:D}),E&&i({...a,[z]:D.toString().length<1})},v=()=>{d(!1),s(l)};return e(j,{children:o($,{open:f,onClose:()=>d(!1),children:[o(G,{children:[e(S,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:l.data,error:a.data,onChange:g,type:"date"}),e(S,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:l.importo,error:a.importo,onChange:g})]}),e(H,{children:e(y,{disabled:u,onClick:v,children:"salva"})})]})})},ue=({tipiDocumento:f,aziende:d,dettagli:s})=>{const l=V(),[n,a]=m.useState({cedente:s.cedente,committente:s.committente,tipoDocumento:s.tipoDocumento,data:s.data,numero:s.numero,totale:s.totale,reparti:s.reparti,scadenze:s.scadenze}),[i,u]=m.useState({cedente:!1,committente:!1,tipoDocumento:!1,data:!1,numero:!1,totale:!1,reparti:!1,scadenze:!1}),[C,g]=m.useState(!1),[v,c]=m.useState(!1),[D,z]=m.useState(!0);m.useEffect(()=>{z(!Object.values(i).every(t=>t===!1))},[i]);const E=(t,r,x)=>{a({...n,cedente:r}),u({...i,cedente:I.isEmpty(r)})},M=(t,r,x)=>{a({...n,committente:r}),u({...i,committente:I.isEmpty(r)})},N=(t,r,x)=>{a({...n,tipoDocumento:r}),u({...i,tipoDocumento:I.isEmpty(r)})},F=t=>{const{value:r,name:x,required:Y}=t.target;a({...n,[x]:r}),Y&&u({...i,[x]:r.toString().length<1})},Q=t=>{const r=[...n.reparti,t];a({...n,reparti:r}),u({...i,reparti:r.length<1})},U=t=>{const r=[...n.reparti];r.splice(t,1),a({...n,reparti:r}),u({...i,reparti:r.length<1})},J=t=>{const r=[...n.scadenze,t];a({...n,scadenze:r}),u({...i,scadenze:r.length<1})},K=t=>{const r=[...n.scadenze];r.splice(t,1),a({...n,scadenze:r}),u({...i,scadenze:r.length<1})},X=()=>{const t={cedente:n.cedente,committente:n.committente,tipoDocumento:n.tipoDocumento,data:n.data,numero:n.numero,totale:n.totale,reparti:n.reparti,scadenze:n.scadenze};l(me(s.id,t))};return o(j,{children:[e(b,{mb:3,children:e(O,{variant:"h3",children:"Aggiungi Fattura"})}),e(b,{mb:3,children:e(R,{children:e(b,{p:2,children:o(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(h,{item:!0,xs:12,children:e(W,{fullWidth:!0,disablePortal:!0,options:f,getOptionLabel:t=>t.descrizione,value:n.tipoDocumento,isOptionEqualToValue:(t,r)=>t.descrizione===r.descrizione,onChange:N,renderInput:t=>e(S,{...t,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:i.tipoDocumento})})}),e(h,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:d,getOptionLabel:t=>t.denominazione,value:n.cedente,isOptionEqualToValue:(t,r)=>t.denominazione===r.denominazione,onChange:E,renderInput:t=>e(S,{...t,label:"Cedente",name:"cedente",required:!0,error:i.cedente})})}),e(h,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:d,getOptionLabel:t=>t.denominazione,value:n.committente,isOptionEqualToValue:(t,r)=>t.denominazione===r.denominazione,onChange:M,renderInput:t=>e(S,{...t,label:"Committente",name:"committente",required:!0,error:i.committente})})}),e(h,{item:!0,xs:12,sm:6,children:e(S,{fullWidth:!0,label:"Data",name:"data",value:n.data,error:i.data,onChange:F,type:"date",required:!0})}),e(h,{item:!0,xs:12,sm:6,children:e(S,{fullWidth:!0,label:"Numero",name:"numero",value:n.numero,error:i.numero,onChange:F,required:!0})}),e(h,{item:!0,xs:12,children:e(S,{fullWidth:!0,label:"Totale documento",name:"totale",value:n.totale,error:i.totale,onChange:F,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(b,{mb:3,children:e(R,{children:o(b,{p:2,children:[o(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(h,{item:!0,xs:6,children:e(O,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(h,{item:!0,xs:6,children:e(b,{sx:{textAlign:"right"},children:e(y,{onClick:()=>g(!0),children:"aggiungi"})})})]}),e(b,{mt:2,children:I.isEmpty(n.reparti)?e(w,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):o(P,{children:[e(L,{children:o(T,{children:[e(p,{children:"Aliquota"}),e(p,{children:"Imponibile"}),e(p,{children:"Imposta"}),e(p,{sx:{width:50},align:"center",children:e(q,{})})]})}),e(k,{children:n.reparti.map((t,r)=>o(T,{children:[o(p,{children:["% ",t.aliquota]}),o(p,{children:["€ ",t.imponibile]}),o(p,{children:["€ ",t.imposta]}),e(p,{children:e(B,{color:"error",onClick:()=>U(r),children:e(q,{})})})]},r))})]})})]})})}),e(b,{mb:3,children:e(R,{children:o(b,{p:2,children:[o(h,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(h,{item:!0,xs:6,children:e(O,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(h,{item:!0,xs:6,children:e(b,{sx:{textAlign:"right"},children:e(y,{onClick:()=>c(!0),children:"aggiungi"})})})]}),e(b,{mt:2,children:I.isEmpty(n.scadenze)?e(w,{severity:"error",children:"Devi aggiungere almeno una scadenza!"}):o(P,{children:[e(L,{children:o(T,{children:[e(p,{children:"Data"}),e(p,{children:"Importo"}),e(p,{sx:{width:50},align:"center",children:e(q,{})})]})}),e(k,{children:n.scadenze.map((t,r)=>o(T,{children:[e(p,{children:t.data}),o(p,{children:["€ ",t.importo]}),e(p,{children:e(B,{color:"error",onClick:()=>K(r),children:e(q,{})})})]},r))})]})})]})})}),e(ce,{open:C,handleClose:g,onSubmit:Q}),e(de,{open:v,handleClose:c,onSubmit:J}),e(ie,{disabled:D,handleClick:X})]})},Ne=()=>{const f=V(),{id:d}=ee(),{dettagli:s,getting:l,getError:n}=A(c=>c.fatture),{list:a,listing:i,listError:u}=A(c=>c.aziende),{list:C,listing:g,listError:v}=A(c=>c.tipiDocFisc);return m.useEffect(()=>{f(ne()),f(ae()),d&&f(se(d))},[d]),l||i||g?e(te,{}):n||u||v?e(re,{message:"Errore caricamento dati"}):e(ue,{dettagli:s,aziende:a,tipiDocumento:C})};export{Ne as default};
