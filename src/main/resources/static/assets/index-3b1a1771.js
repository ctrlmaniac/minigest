import{R as o,j as e,F as w,a as i,aJ as Y,aK as Z,L as z,B as h,P as _}from"./index-f96e3560.js";import{l as ee}from"./list-5903d305.js";import{l as te}from"./list-7a44ee65.js";import{u as L,a as R}from"./hooks-9f30ad4b.js";import{S as ne}from"./SaveFab-613960c9.js";import{a as $,b as G}from"./DialogContent-d6752986.js";import{T as g}from"./TextField-b06cea5a.js";import{D as H}from"./DialogActions-2b3f7736.js";import{B as E}from"./Button-c10cadba.js";import{a as re,E as ae}from"./index-e540bbee.js";import{T as A}from"./Typography-4d9115c9.js";import{P as O}from"./Paper-661358a8.js";import{G as d}from"./Grid-544d987d.js";import{A as W}from"./Autocomplete-1bc959d1.js";import{A as j,I as B}from"./Alert-bac571b5.js";import{T as k,a as q,b as s,c as P}from"./TableRow-3feee7d7.js";import{T as V}from"./TableHead-fa078fde.js";import{I as y}from"./IconTrash-0d016c1d.js";import"./Container-8d72809c.js";import"./Fab-443a133d.js";import"./ButtonBase-2e279362.js";import"./createReactComponent-6e8dbf88.js";import"./useTheme-935eac68.js";import"./Modal-26427fd5.js";import"./utils-78862c06.js";import"./Grow-214d7052.js";import"./List-22de0ac9.js";import"./createSvgIcon-b6946a7a.js";import"./Popper-7ebb6a2e.js";import"./ListSubheader-a34a186e.js";const ie=({open:p,handleClose:c,onSubmit:m})=>{const[t,l]=o.useState({aliquota:22,imponibile:0,imposta:0}),[a,u]=o.useState({aliquota:!1,imponibile:!1,imposta:!1}),[x,v]=o.useState(!0);o.useEffect(()=>{v(!Object.values(a).every(f=>f===!1))},[a]);const b=f=>{const{value:S,name:C,required:I}=f.target;l({...t,[C]:S}),I&&u({...a,[C]:S.toString().length<1})},D=()=>{c(!1),m(t)};return e(w,{children:i($,{open:p,onClose:()=>c(!1),children:[i(G,{children:[e(g,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:t.aliquota,error:a.aliquota,onChange:b}),e(g,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:t.imponibile,error:a.imponibile,onChange:b}),e(g,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:t.imposta,error:a.imposta,onChange:b})]}),e(H,{children:e(E,{disabled:x,onClick:D,children:"salva"})})]})})};function oe(p){return async c=>{re.post(`${ae.FATTURE}`,p).then(m=>{c(Y(m.data)),window.location.href=`/app/docfisc/fatture/dettagli/${m.data.id}`}).catch(m=>{c(Z(m.message))})}}const le=({open:p,handleClose:c,onSubmit:m})=>{const[t,l]=o.useState({data:new Date().toISOString().split("T")[0],importo:0}),[a,u]=o.useState({data:!1,importo:!1}),[x,v]=o.useState(!0);o.useEffect(()=>{v(!Object.values(a).every(f=>f===!1))},[a]);const b=f=>{const{value:S,name:C,required:I}=f.target;l({...t,[C]:S}),I&&u({...a,[C]:S.toString().length<1})},D=()=>{c(!1),m(t)};return e(w,{children:i($,{open:p,onClose:()=>c(!1),children:[i(G,{children:[e(g,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:t.data,error:a.data,onChange:b,type:"date"}),e(g,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:t.importo,error:a.importo,onChange:b})]}),e(H,{children:e(E,{disabled:x,onClick:D,children:"salva"})})]})})},se=({tipiDocumento:p,aziende:c})=>{const m=L(),[t,l]=o.useState({cedente:null,committente:null,tipoDocumento:z.find(p,["descrizione","fattura"])||null,data:new Date().toISOString().split("T")[0],numero:"",totale:0,reparti:[],scadenze:[]}),[a,u]=o.useState({cedente:!0,committente:!0,tipoDocumento:!1,data:!1,numero:!0,totale:!1,reparti:!0,scadenze:!0}),[x,v]=o.useState(!1),[b,D]=o.useState(!1),[f,S]=o.useState(!0);o.useEffect(()=>{S(!Object.values(a).every(n=>n===!1))},[a]);const C=(n,r,T)=>{l({...t,cedente:r}),u({...a,cedente:z.isEmpty(r)})},I=(n,r,T)=>{l({...t,committente:r}),u({...a,committente:z.isEmpty(r)})},J=(n,r,T)=>{l({...t,tipoDocumento:r}),u({...a,tipoDocumento:z.isEmpty(r)})},F=n=>{const{value:r,name:T,required:X}=n.target;l({...t,[T]:r}),X&&u({...a,[T]:r.length<1})},K=n=>{const r=[...t.reparti,n];l({...t,reparti:r}),u({...a,reparti:r.length<1})},N=n=>{const r=[...t.reparti];r.splice(n,1),l({...t,reparti:r}),u({...a,reparti:r.length<1})},U=n=>{const r=[...t.scadenze,n];l({...t,scadenze:r}),u({...a,scadenze:r.length<1})},M=n=>{const r=[...t.scadenze];r.splice(n,1),l({...t,scadenze:r}),u({...a,scadenze:r.length<1})},Q=()=>{const n={cedente:t.cedente,committente:t.committente,tipoDocumento:t.tipoDocumento,data:t.data,numero:t.numero,totale:t.totale,reparti:t.reparti,scadenze:t.scadenze};m(oe(n))};return i(w,{children:[e(h,{mb:3,children:e(A,{variant:"h3",children:"Aggiungi Fattura"})}),e(h,{mb:3,children:e(O,{children:e(h,{p:2,children:i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(d,{item:!0,xs:12,children:e(W,{fullWidth:!0,disablePortal:!0,options:p,getOptionLabel:n=>n.descrizione,value:t.tipoDocumento,isOptionEqualToValue:(n,r)=>n.descrizione===r.descrizione,onChange:J,renderInput:n=>e(g,{...n,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:a.tipoDocumento})})}),e(d,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:c,getOptionLabel:n=>n.denominazione,value:t.cedente,isOptionEqualToValue:(n,r)=>n.denominazione===r.denominazione,onChange:C,renderInput:n=>e(g,{...n,label:"Cedente",name:"cedente",required:!0,error:a.cedente})})}),e(d,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,disablePortal:!0,options:c,getOptionLabel:n=>n.denominazione,value:t.committente,isOptionEqualToValue:(n,r)=>n.denominazione===r.denominazione,onChange:I,renderInput:n=>e(g,{...n,label:"Committente",name:"committente",required:!0,error:a.committente})})}),e(d,{item:!0,xs:12,sm:6,children:e(g,{fullWidth:!0,label:"Data",name:"data",value:t.data,error:a.data,onChange:F,type:"date",required:!0})}),e(d,{item:!0,xs:12,sm:6,children:e(g,{fullWidth:!0,label:"Numero",name:"numero",value:t.numero,error:a.numero,onChange:F,required:!0})}),e(d,{item:!0,xs:12,children:e(g,{fullWidth:!0,label:"Totale documento",name:"totale",value:t.totale,error:a.totale,onChange:F,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(h,{mb:3,children:e(O,{children:i(h,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(A,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(d,{item:!0,xs:6,children:e(h,{sx:{textAlign:"right"},children:e(E,{onClick:()=>v(!0),children:"aggiungi"})})})]}),e(h,{mt:2,children:z.isEmpty(t.reparti)?e(j,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):i(k,{children:[e(V,{children:i(q,{children:[e(s,{children:"Aliquota"}),e(s,{children:"Imponibile"}),e(s,{children:"Imposta"}),e(s,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(P,{children:t.reparti.map((n,r)=>i(q,{children:[i(s,{children:["% ",n.aliquota]}),i(s,{children:["€ ",n.imponibile]}),i(s,{children:["€ ",n.imposta]}),e(s,{children:e(B,{color:"error",onClick:()=>N(r),children:e(y,{})})})]},r))})]})})]})})}),e(h,{children:e(O,{children:i(h,{p:2,children:[i(d,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(d,{item:!0,xs:6,children:e(A,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(d,{item:!0,xs:6,children:e(h,{sx:{textAlign:"right"},children:e(E,{onClick:()=>D(!0),children:"aggiungi"})})})]}),e(h,{mt:2,children:z.isEmpty(t.scadenze)?e(j,{severity:"error",children:"Devi aggiungere almeno una scadenza!"}):i(k,{children:[e(V,{children:i(q,{children:[e(s,{children:"Data"}),e(s,{children:"Importo"}),e(s,{sx:{width:50},align:"center",children:e(y,{})})]})}),e(P,{children:t.scadenze.map((n,r)=>i(q,{children:[e(s,{children:n.data}),i(s,{children:["€ ",n.importo]}),e(s,{children:e(B,{color:"error",onClick:()=>M(r),children:e(y,{})})})]},r))})]})})]})})}),e(ie,{open:x,handleClose:v,onSubmit:K}),e(le,{open:b,handleClose:D,onSubmit:U}),e(ne,{disabled:f,handleClick:Q})]})},Ve=()=>{const p=L(),{list:c,listing:m}=R(a=>a.aziende),{list:t,listing:l}=R(a=>a.tipiDocFisc);return o.useEffect(()=>{p(ee()),p(te())},[]),m||l?e(_,{}):e(se,{aziende:c,tipiDocumento:t})};export{Ve as default};
