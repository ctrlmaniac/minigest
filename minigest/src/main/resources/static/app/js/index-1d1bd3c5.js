import{R as s,d as a,j as e,aU as H,aV as U,aW as V,i as G,F as N,l as C,ad as L,aM as M}from"./index-4508a384.js";import{f as _,e as E,B as p,T as F,P as x}from"./hooks-feb29949.js";import{a as $,b as J}from"./DialogContent-b1fa8429.js";import{T as g}from"./TextField-0bc7661e.js";import{D as K}from"./DialogActions-690afbfc.js";import{B}from"./Button-d9755764.js";import{a as Q,E as X,I as Y}from"./index-638748d8.js";import{A as D}from"./Alert-79195361.js";import{A as Z}from"./AlertTitle-025f351d.js";import{I as ee}from"./IconBuildingStore-051380fe.js";import{G as q}from"./Grid-b984e7a0.js";import{T as te,a as I,b as o,c as ae}from"./TableRow-89215d33.js";import{T as re}from"./TableHead-4c925618.js";import{I as z}from"./IconTrash-faf9702e.js";import{S as ie}from"./Snackbar-616aa609.js";import"./Grow-e4ee19b9.js";import"./useFormControl-3c13f0cf.js";import"./createReactComponent-3ef021e5.js";const ne=({open:f,handleClose:d,handleSubmit:i})=>{const[r,S]=s.useState({aliquota:22,totale:0,totaleAnnulli:0,totaleResi:0}),[n,A]=s.useState({aliquota:!1,totale:!1,totaleAnnulli:!1,totaleResi:!1}),m=b=>{const{name:c,value:y,required:v}=b.target;S({...r,[c]:y}),v&&A({...n,[c]:y.length<1})},[h,R]=s.useState(!0);s.useEffect(()=>{R(!Object.values(n).every(b=>b===!1))},[n]);const u=()=>{d(!1),i(r)};return a($,{open:f,onClose:()=>d(!1),children:[a(J,{children:[e(g,{label:"aliquota",name:"aliquota",value:r.aliquota,error:n.aliquota,fullWidth:!0,required:!0,onChange:m,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale",name:"totale",value:r.totale,error:n.totale,fullWidth:!0,required:!0,onChange:m,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale annulli",name:"totaleAnnulli",value:r.totaleAnnulli,error:n.totaleAnnulli,fullWidth:!0,required:!0,onChange:m,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale resi",name:"totaleResi",value:r.totaleResi,error:n.totaleResi,fullWidth:!0,required:!0,onChange:m,margin:"normal",type:"number",inputProps:{step:.01}})]}),e(K,{children:e(B,{disabled:h,onClick:u,children:"Salva"})})]})};function le(f){return async d=>{d(H()),Q.post(`${X.CHIUSURE_FISCALI}`,f).then(i=>{d(U(i.data))}).catch(i=>{let r="Errore";i.response?r=i.response.data:r="Errore",d(V(r))})}}const qe=()=>{const f=_(),d=G(),{selected:i}=E(t=>t.negozi),{posting:r,postError:S,response:n}=E(t=>t.chiusureFiscali),[A,m]=s.useState(!1),[h,R]=s.useState({data:new Date().toISOString().split("T")[0],totale:0,numeroDocFisc:0}),[u,b]=s.useState([]),[c,y]=s.useState({data:!1,totale:!1,numeroDocFisc:!1}),v=t=>{const{name:l,value:T,required:O}=t.target;R({...h,[l]:T}),O&&y({...c,[l]:T.length<1})},[W,P]=s.useState(!0);s.useEffect(()=>{const t=!Object.values(c).every(l=>l===!1);P(t||u.length<1)},[c,u]);const j=t=>{b([...u,t])},k=t=>{const l=[...u];l.splice(t,1),b(l)},w=()=>{const t={negozio:i,...h,reparti:[...u]};f(le(t)),S||setTimeout(()=>{f(M()),d("/docfisc/chiusure-fiscali")},1e3)};return a(N,{children:[e(p,{mb:3,children:e(F,{variant:"h3",children:"Aggiungi Chiusura Fiscale"})}),C.isEmpty(i)?a(D,{variant:"outlined",severity:"error",sx:{marginBottom:3},children:[e(Z,{children:"Devi selezionare un negozio!"}),"Per visualizzare le chiusure fiscali devi prima selezionare un negozio. Clicca sull'icona ",e(ee,{})," in alto a sinistra e selezionane uno!"]}):a(D,{variant:"outlined",severity:"info",sx:{marginBottom:3},children:["Stai aggiungendo una chiusura fiscale al negozio ",i.nome]}),e(p,{mb:3,children:e(x,{children:a(p,{p:2,children:[e(g,{label:"Data",name:"data",value:h.data,error:c.data,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"date"}),e(g,{label:"Totale",name:"totale",value:h.totale,error:c.totale,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"number"}),e(g,{label:"Num. D.F.",name:"numeroDocFisc",value:h.numeroDocFisc,error:c.numeroDocFisc,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"number"})]})})}),e(p,{children:e(x,{children:a(p,{p:2,children:[a(q,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(q,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(q,{item:!0,xs:6,children:e(p,{sx:{textAlign:"right"},children:e(B,{onClick:()=>m(!0),children:"aggiungi"})})})]}),e(p,{mt:2,children:C.isEmpty(u)?e(D,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):a(te,{children:[e(re,{children:a(I,{children:[e(o,{children:"Aliquota"}),e(o,{children:"Totale"}),e(o,{children:"Annulli"}),e(o,{children:"Resi"}),e(o,{sx:{width:50},align:"center",children:e(z,{})})]})}),e(ae,{children:u.map((t,l)=>a(I,{children:[a(o,{children:[t.aliquota," %"]}),a(o,{children:[t.totale," €"]}),a(o,{children:[t.totaleAnnulli," €"]}),a(o,{children:[t.totaleResi," €"]}),e(o,{align:"center",children:e(Y,{color:"error",onClick:()=>k(l),children:e(z,{})})})]},l))})]})})]})})}),e(ne,{open:A,handleClose:m,handleSubmit:j}),e(L,{onClick:w,disabled:W||C.isEmpty(i),loading:r}),e(ie,{open:!C.isEmpty(n),children:e(D,{severity:S?"error":"success",children:n})})]})};export{qe as default};
