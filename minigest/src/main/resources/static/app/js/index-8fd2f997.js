import{R as c,j as e,F as w,d as r,b7 as ie,b8 as oe,b9 as le,i as se,l as x,a7 as ce,b3 as de,B as me}from"./index-8d810eb5.js";import{l as ue}from"./list-bd72f3f2.js";import{A as P,l as he}from"./list-fbff14e2.js";import{f as $,e as V,B as h,T as A,P as O}from"./hooks-29c1883f.js";import{a as L,b as G}from"./DialogContent-c0f22f68.js";import{T as g}from"./TextField-19a3feee.js";import{D as N}from"./DialogActions-aac5d650.js";import{B as T}from"./Button-09a45d57.js";import{a as pe,E as ge,I as j}from"./index-369028e4.js";import{G as m}from"./Grid-a6d2df67.js";import{A as W}from"./Alert-ac51448d.js";import{T as k,b as y,c as s,a as B}from"./TableRow-7bd9e227.js";import{T as R}from"./TableHead-49d1eeb5.js";import{I as E}from"./IconTrash-77e3418a.js";import{S as fe}from"./Snackbar-ee143c36.js";import"./ListSubheader-d6e323ba.js";import"./createReactComponent-fd9b34e9.js";const be=({open:f,handleClose:d,onSubmit:p})=>{const[l,C]=c.useState({aliquota:22,imponibile:0,imposta:0}),[i,I]=c.useState({aliquota:!1,imponibile:!1,imposta:!1}),[n,u]=c.useState(!0);c.useEffect(()=>{u(!Object.values(i).every(b=>b===!1))},[i]);const o=b=>{const{value:v,name:D,required:z}=b.target;C({...l,[D]:v}),z&&I({...i,[D]:v.toString().length<1})},S=()=>{d(!1),p(l)};return e(w,{children:r(L,{open:f,onClose:()=>d(!1),children:[r(G,{children:[e(g,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:l.aliquota,error:i.aliquota,onChange:o}),e(g,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:l.imponibile,error:i.imponibile,onChange:o}),e(g,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:l.imposta,error:i.imposta,onChange:o})]}),e(N,{children:e(T,{disabled:n,onClick:S,children:"salva"})})]})})};function Se(f){return async d=>{d(ie()),pe.post(`${ge.FATTURE}`,f).then(p=>{d(oe(p.data))}).catch(p=>{let l="Errore";p.response?l=p.response.data:l="Errore",d(le(l))})}}const ve=({open:f,handleClose:d,onSubmit:p})=>{const[l,C]=c.useState({data:new Date().toISOString().split("T")[0],importo:0}),[i,I]=c.useState({data:!1,importo:!1}),[n,u]=c.useState(!0);c.useEffect(()=>{u(!Object.values(i).every(b=>b===!1))},[i]);const o=b=>{const{value:v,name:D,required:z}=b.target;C({...l,[D]:v}),z&&I({...i,[D]:v.toString().length<1})},S=()=>{d(!1),p(l)};return e(w,{children:r(L,{open:f,onClose:()=>d(!1),children:[r(G,{children:[e(g,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:l.data,error:i.data,onChange:o,type:"date"}),e(g,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:l.importo,error:i.importo,onChange:o})]}),e(N,{children:e(T,{disabled:n,onClick:S,children:"salva"})})]})})},De=({open:f,handleClose:d,onSubmit:p})=>{const[l,C]=c.useState({data:new Date().toISOString().split("T")[0],importo:0}),[i,I]=c.useState({data:!1,importo:!1}),[n,u]=c.useState(!0);c.useEffect(()=>{u(!Object.values(i).every(b=>b===!1))},[i]);const o=b=>{const{value:v,name:D,required:z}=b.target;C({...l,[D]:v}),z&&I({...i,[D]:v.toString().length<1})},S=()=>{d(!1),p(l)};return e(w,{children:r(L,{open:f,onClose:()=>d(!1),children:[r(G,{children:[e(g,{fullWidth:!0,label:"Data Pagamento",name:"data",margin:"normal",value:l.data,error:i.data,onChange:o,type:"date"}),e(g,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:l.importo,error:i.importo,onChange:o})]}),e(N,{children:e(T,{disabled:n,onClick:S,children:"salva"})})]})})},Ce=({tipiDocumento:f,aziende:d})=>{const p=$(),l=se(),{posting:C,postError:i,response:I}=V(t=>t.fatture),[n,u]=c.useState({cedente:null,committente:null,tipoDocumento:x.find(f,["descrizione","fattura"])||null,data:new Date().toISOString().split("T")[0],dataSDI:"",numero:"",totale:0,reparti:[],scadenze:[],pagamenti:[]}),[o,S]=c.useState({cedente:!0,committente:!0,tipoDocumento:!1,data:!1,dataSDI:!1,numero:!0,totale:!1,reparti:!0,scadenze:!1,pagamenti:!1}),[b,v]=c.useState(!1),[D,z]=c.useState(!1),[H,Q]=c.useState(!1),[U,J]=c.useState(!0);c.useEffect(()=>{J(!Object.values(o).every(t=>t===!1))},[o]);const K=(t,a,q)=>{u({...n,cedente:a}),S({...o,cedente:x.isEmpty(a)})},M=(t,a,q)=>{u({...n,committente:a}),S({...o,committente:x.isEmpty(a)})},X=(t,a,q)=>{u({...n,tipoDocumento:a}),S({...o,tipoDocumento:x.isEmpty(a)})},F=t=>{const{value:a,name:q,required:re}=t.target;u({...n,[q]:a}),re&&S({...o,[q]:a.length<1})},Y=t=>{const a=[...n.reparti,t];u({...n,reparti:a}),S({...o,reparti:a.length<1})},Z=t=>{const a=[...n.reparti];a.splice(t,1),u({...n,reparti:a}),S({...o,reparti:a.length<1})},_=t=>{const a=[...n.scadenze,t];u({...n,scadenze:a})},ee=t=>{const a=[...n.scadenze];a.splice(t,1),u({...n,scadenze:a})},te=t=>{const a=[...n.pagamenti,t];u({...n,pagamenti:a})},ne=t=>{const a=[...n.pagamenti];a.splice(t,1),u({...n,pagamenti:a})},ae=()=>{const t={cedente:n.cedente,committente:n.committente,tipoDocumento:n.tipoDocumento,data:n.data,dataSDI:n.dataSDI,numero:n.numero,totale:n.totale,reparti:n.reparti,scadenze:n.scadenze,pagamenti:n.pagamenti};p(Se(t)),setTimeout(()=>{de(),i||l(-1)},1e3)};return r(w,{children:[e(h,{mb:3,children:e(A,{variant:"h3",children:"Aggiungi Fattura"})}),e(h,{mb:3,children:e(O,{children:e(h,{p:2,children:r(m,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(m,{item:!0,xs:12,children:e(P,{fullWidth:!0,disablePortal:!0,options:f,getOptionLabel:t=>t.descrizione,value:n.tipoDocumento,isOptionEqualToValue:(t,a)=>t.descrizione===a.descrizione,onChange:X,renderInput:t=>e(g,{...t,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:o.tipoDocumento})})}),e(m,{item:!0,xs:12,sm:6,children:e(P,{fullWidth:!0,disablePortal:!0,options:d,getOptionLabel:t=>t.denominazione,value:n.cedente,isOptionEqualToValue:(t,a)=>t.denominazione===a.denominazione,onChange:K,renderInput:t=>e(g,{...t,label:"Cedente",name:"cedente",required:!0,error:o.cedente})})}),e(m,{item:!0,xs:12,sm:6,children:e(P,{fullWidth:!0,disablePortal:!0,options:d,getOptionLabel:t=>t.denominazione,value:n.committente,isOptionEqualToValue:(t,a)=>t.denominazione===a.denominazione,onChange:M,renderInput:t=>e(g,{...t,label:"Committente",name:"committente",required:!0,error:o.committente})})}),e(m,{item:!0,xs:12,sm:6,children:e(g,{fullWidth:!0,label:"Data",name:"data",value:n.data,error:o.data,onChange:F,type:"date",required:!0})}),e(m,{item:!0,xs:12,sm:6,children:e(g,{fullWidth:!0,label:"Data SDI",name:"dataSDI",value:n.dataSDI,error:o.dataSDI,onChange:F,type:"date"})}),e(m,{item:!0,xs:12,children:e(g,{fullWidth:!0,label:"Numero",name:"numero",value:n.numero,error:o.numero,onChange:F,required:!0})}),e(m,{item:!0,xs:12,children:e(g,{fullWidth:!0,label:"Totale documento",name:"totale",value:n.totale,error:o.totale,onChange:F,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(h,{mb:3,children:e(O,{children:r(h,{p:2,children:[r(m,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(m,{item:!0,xs:6,children:e(A,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(m,{item:!0,xs:6,children:e(h,{sx:{textAlign:"right"},children:e(T,{onClick:()=>v(!0),children:"aggiungi"})})})]}),e(h,{mt:2,children:x.isEmpty(n.reparti)?e(W,{severity:"error",variant:"outlined",children:"Devi aggiungere almeno un reparto!"}):r(k,{children:[e(R,{children:r(y,{children:[e(s,{children:"Aliquota"}),e(s,{children:"Imponibile"}),e(s,{children:"Imposta"}),e(s,{sx:{width:50},align:"center",children:e(E,{})})]})}),e(B,{children:n.reparti.map((t,a)=>r(y,{children:[r(s,{children:["% ",t.aliquota]}),r(s,{children:["€ ",t.imponibile]}),r(s,{children:["€ ",t.imposta]}),e(s,{children:e(j,{color:"error",onClick:()=>Z(a),children:e(E,{})})})]},a))})]})})]})})}),e(h,{mb:3,children:e(O,{children:r(h,{p:2,children:[r(m,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(m,{item:!0,xs:6,children:e(A,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(m,{item:!0,xs:6,children:e(h,{sx:{textAlign:"right"},children:e(T,{onClick:()=>z(!0),children:"aggiungi"})})})]}),e(h,{mt:2,children:x.isEmpty(n.scadenze)?e(W,{severity:"warning",variant:"outlined",children:"Questa fattura non ha scadenze! Verrà contata la data del documento come scadenza unica!"}):r(k,{children:[e(R,{children:r(y,{children:[e(s,{children:"Data"}),e(s,{children:"Importo"}),e(s,{sx:{width:50},align:"center",children:e(E,{})})]})}),e(B,{children:n.scadenze.map((t,a)=>r(y,{children:[e(s,{children:t.data}),r(s,{children:["€ ",t.importo]}),e(s,{children:e(j,{color:"error",onClick:()=>ee(a),children:e(E,{})})})]},a))})]})})]})})}),e(h,{children:e(O,{children:r(h,{p:2,children:[r(m,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(m,{item:!0,xs:6,children:e(A,{variant:"h6",gutterBottom:!0,children:"Pagamenti"})}),e(m,{item:!0,xs:6,children:e(h,{sx:{textAlign:"right"},children:e(T,{onClick:()=>Q(!0),children:"aggiungi"})})})]}),e(h,{mt:2,children:x.isEmpty(n.pagamenti)?e(W,{severity:"warning",variant:"outlined",children:"Questa fattura non ha pagamenti registrati"}):r(k,{children:[e(R,{children:r(y,{children:[e(s,{children:"Data"}),e(s,{children:"Importo"}),e(s,{sx:{width:50},align:"center",children:e(E,{})})]})}),e(B,{children:n.pagamenti.map((t,a)=>r(y,{children:[e(s,{children:t.data}),r(s,{children:["€ ",t.importo]}),e(s,{children:e(j,{color:"error",onClick:()=>ne(a),children:e(E,{})})})]},a))})]})})]})})}),e(be,{open:b,handleClose:v,onSubmit:Y}),e(ve,{open:D,handleClose:z,onSubmit:_}),e(De,{open:H,handleClose:Q,onSubmit:te}),e(ce,{disabled:U,onClick:ae,loading:C}),e(fe,{open:!x.isEmpty(I),children:e(W,{severity:i?"error":"success",children:I})})]})},Ve=()=>{const f=$(),{list:d,listing:p}=V(i=>i.aziende),{list:l,listing:C}=V(i=>i.tipiDocFisc);return c.useEffect(()=>{f(ue()),f(he())},[]),p&&C?e(me,{}):e(Ce,{aziende:d,tipiDocumento:l})};export{Ve as default};
