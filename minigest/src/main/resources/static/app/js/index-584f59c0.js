import{R as u,j as e,F as j,d as r,bh as le,bi as se,bj as ce,i as de,l as v,ad as me,b6 as ue,ao as he,B as pe,V as Q}from"./index-2aee8fbc.js";import{l as ge}from"./list-ea1c9102.js";import{A as w,l as fe}from"./list-119888a0.js";import{f as H,e as P,B as g,T as O,P as W}from"./hooks-ac52b7c3.js";import{a as L,b as $}from"./DialogContent-6c601b28.js";import{T as f}from"./TextField-2b7385a2.js";import{D as G}from"./DialogActions-477a5182.js";import{B as T}from"./Button-61285a26.js";import{a as be,E as Se,I as k}from"./index-d540e9b2.js";import{G as p}from"./Grid-75cf535a.js";import{A}from"./Alert-442bcf26.js";import{T as B,a as z,b as m,c as R}from"./TableRow-4c838dfa.js";import{T as V}from"./TableHead-d6dd838d.js";import{I as x}from"./IconTrash-b259a790.js";import{S as De}from"./Snackbar-6116d8ac.js";import{g as ve}from"./get-6c20720b.js";import"./Grow-60e7aeaa.js";import"./ListSubheader-e76041cd.js";import"./createReactComponent-c382b839.js";const Ce=({open:b,handleClose:h,onSubmit:i})=>{const[o,S]=u.useState({aliquota:22,imponibile:0,imposta:0}),[s,C]=u.useState({aliquota:!1,imponibile:!1,imposta:!1}),[E,a]=u.useState(!0);u.useEffect(()=>{a(!Object.values(s).every(l=>l===!1))},[s]);const d=l=>{const{value:I,name:D,required:y}=l.target;S({...o,[D]:I}),y&&C({...s,[D]:I.toString().length<1})},c=()=>{h(!1),i(o)};return e(j,{children:r(L,{open:b,onClose:()=>h(!1),children:[r($,{children:[e(f,{fullWidth:!0,label:"Aliquota IVA",name:"aliquota",margin:"normal",value:o.aliquota,error:s.aliquota,onChange:d}),e(f,{fullWidth:!0,label:"Imponibile",name:"imponibile",margin:"normal",value:o.imponibile,error:s.imponibile,onChange:d}),e(f,{fullWidth:!0,label:"Imposta",name:"imposta",margin:"normal",value:o.imposta,error:s.imposta,onChange:d})]}),e(G,{children:e(T,{disabled:E,onClick:c,children:"salva"})})]})})};function Ee(b,h){return async i=>{i(le()),be.put(`${Se.FATTURE}/${b}`,h).then(o=>{i(se(o.data))}).catch(o=>{let S="Errore";o.response?S=o.response.data:S="Errore",i(ce(S))})}}const Ie=({open:b,handleClose:h,onSubmit:i})=>{const[o,S]=u.useState({data:new Date().toISOString().split("T")[0],importo:0}),[s,C]=u.useState({data:!1,importo:!1}),[E,a]=u.useState(!0);u.useEffect(()=>{a(!Object.values(s).every(l=>l===!1))},[s]);const d=l=>{const{value:I,name:D,required:y}=l.target;S({...o,[D]:I}),y&&C({...s,[D]:I.toString().length<1})},c=()=>{h(!1),i(o)};return e(j,{children:r(L,{open:b,onClose:()=>h(!1),children:[r($,{children:[e(f,{fullWidth:!0,label:"Data Scadenza",name:"data",margin:"normal",value:o.data,error:s.data,onChange:d,type:"date"}),e(f,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:o.importo,error:s.importo,onChange:d})]}),e(G,{children:e(T,{disabled:E,onClick:c,children:"salva"})})]})})},ye=({open:b,handleClose:h,onSubmit:i})=>{const[o,S]=u.useState({data:new Date().toISOString().split("T")[0],importo:0}),[s,C]=u.useState({data:!1,importo:!1}),[E,a]=u.useState(!0);u.useEffect(()=>{a(!Object.values(s).every(l=>l===!1))},[s]);const d=l=>{const{value:I,name:D,required:y}=l.target;S({...o,[D]:I}),y&&C({...s,[D]:I.toString().length<1})},c=()=>{h(!1),i(o)};return e(j,{children:r(L,{open:b,onClose:()=>h(!1),children:[r($,{children:[e(f,{fullWidth:!0,label:"Data Pagamento",name:"data",margin:"normal",value:o.data,error:s.data,onChange:d,type:"date"}),e(f,{fullWidth:!0,label:"Importo",name:"importo",margin:"normal",value:o.importo,error:s.importo,onChange:d})]}),e(G,{children:e(T,{disabled:E,onClick:c,children:"salva"})})]})})},ze=({tipiDocumento:b,aziende:h,dettagli:i})=>{const o=H(),S=de(),{putting:s,putError:C,response:E}=P(t=>t.fatture),[a,d]=u.useState({cedente:i.cedente,committente:i.committente,tipoDocumento:i.tipoDocumento,data:i.data,dataSDI:i.dataSDI||"",numero:i.numero,totale:i.totale,reparti:i.reparti||[],scadenze:i.scadenze||[],pagamenti:i.pagamenti||[]}),[c,l]=u.useState({cedente:!1,committente:!1,tipoDocumento:!1,data:!1,dataSDI:!1,numero:!1,totale:!1,reparti:v.isEmpty(i.reparti),scadenze:!1,pagamenti:!1}),[I,D]=u.useState(!1),[y,M]=u.useState(!1),[U,N]=u.useState(!1),[J,K]=u.useState(!0);u.useEffect(()=>{K(!Object.values(c).every(t=>t===!1))},[c]);const X=(t,n,q)=>{d({...a,cedente:n}),l({...c,cedente:v.isEmpty(n)})},Y=(t,n,q)=>{d({...a,committente:n}),l({...c,committente:v.isEmpty(n)})},Z=(t,n,q)=>{d({...a,tipoDocumento:n}),l({...c,tipoDocumento:v.isEmpty(n)})},F=t=>{const{value:n,name:q,required:oe}=t.target;d({...a,[q]:n}),oe&&l({...c,[q]:n.toString().length<1})},_=t=>{const n=[...a.reparti,t];d({...a,reparti:n}),l({...c,reparti:n.length<1})},ee=t=>{const n=[...a.reparti];n.splice(t,1),d({...a,reparti:n}),l({...c,reparti:n.length<1})},te=t=>{const n=[...a.scadenze,t];d({...a,scadenze:n})},ae=t=>{const n=[...a.scadenze];n.splice(t,1),d({...a,scadenze:n})},ne=t=>{const n=[...a.pagamenti,t];d({...a,pagamenti:n})},re=t=>{const n=[...a.pagamenti];n.splice(t,1),d({...a,pagamenti:n})},ie=()=>{const t={cedente:a.cedente,committente:a.committente,tipoDocumento:a.tipoDocumento,data:a.data,dataSDI:a.dataSDI,numero:a.numero,totale:a.totale,reparti:[...a.reparti],scadenze:[...a.scadenze],pagamenti:[...a.pagamenti]};o(Ee(i.id,t)),setTimeout(()=>{ue(),C||S(-1)},1e3)};return r(j,{children:[e(g,{mb:3,children:e(O,{variant:"h3",children:"Modifica Fattura"})}),e(g,{mb:3,children:e(W,{children:e(g,{p:2,children:r(p,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",spacing:2,children:[e(p,{item:!0,xs:12,children:e(w,{fullWidth:!0,disablePortal:!0,options:b,getOptionLabel:t=>t.descrizione,value:a.tipoDocumento,isOptionEqualToValue:(t,n)=>t.descrizione===n.descrizione,onChange:Z,renderInput:t=>e(f,{...t,label:"Tipo Doc. Fisc.",name:"tipoDocumento",required:!0,error:c.tipoDocumento})})}),e(p,{item:!0,xs:12,sm:6,children:e(w,{fullWidth:!0,disablePortal:!0,options:h,getOptionLabel:t=>t.denominazione,value:a.cedente,isOptionEqualToValue:(t,n)=>t.denominazione===n.denominazione,onChange:X,renderInput:t=>e(f,{...t,label:"Cedente",name:"cedente",required:!0,error:c.cedente})})}),e(p,{item:!0,xs:12,sm:6,children:e(w,{fullWidth:!0,disablePortal:!0,options:h,getOptionLabel:t=>t.denominazione,value:a.committente,isOptionEqualToValue:(t,n)=>t.denominazione===n.denominazione,onChange:Y,renderInput:t=>e(f,{...t,label:"Committente",name:"committente",required:!0,error:c.committente})})}),e(p,{item:!0,xs:12,sm:6,children:e(f,{fullWidth:!0,label:"Data",name:"data",value:a.data,error:c.data,onChange:F,type:"date",required:!0})}),e(p,{item:!0,xs:12,sm:6,children:e(f,{fullWidth:!0,label:"Data SDI",name:"dataSDI",value:a.dataSDI,error:c.dataSDI,onChange:F,type:"date"})}),e(p,{item:!0,xs:12,children:e(f,{fullWidth:!0,label:"Numero",name:"numero",value:a.numero,error:c.numero,onChange:F,required:!0})}),e(p,{item:!0,xs:12,children:e(f,{fullWidth:!0,label:"Totale documento",name:"totale",value:a.totale,error:c.totale,onChange:F,type:"number",inputProps:{step:.01},required:!0})})]})})})}),e(g,{mb:3,children:e(W,{children:r(g,{p:2,children:[r(p,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(p,{item:!0,xs:6,children:e(O,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(p,{item:!0,xs:6,children:e(g,{sx:{textAlign:"right"},children:e(T,{onClick:()=>D(!0),children:"aggiungi"})})})]}),e(g,{mt:2,children:v.isEmpty(a.reparti)?e(A,{severity:"error",variant:"outlined",children:"Devi aggiungere almeno un reparto!"}):r(B,{children:[e(V,{children:r(z,{children:[e(m,{children:"Aliquota"}),e(m,{children:"Imponibile"}),e(m,{children:"Imposta"}),e(m,{sx:{width:50},align:"center",children:e(x,{})})]})}),e(R,{children:a.reparti.map((t,n)=>r(z,{children:[r(m,{children:["% ",t.aliquota]}),r(m,{children:["€ ",t.imponibile]}),r(m,{children:["€ ",t.imposta]}),e(m,{children:e(k,{color:"error",onClick:()=>ee(n),children:e(x,{})})})]},n))})]})})]})})}),e(g,{mb:3,children:e(W,{children:r(g,{p:2,children:[r(p,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(p,{item:!0,xs:6,children:e(O,{variant:"h6",gutterBottom:!0,children:"Scadenze"})}),e(p,{item:!0,xs:6,children:e(g,{sx:{textAlign:"right"},children:e(T,{onClick:()=>M(!0),children:"aggiungi"})})})]}),e(g,{mt:2,children:v.isEmpty(a.scadenze)?e(A,{severity:"warning",variant:"outlined",children:"Questa fattura non ha scadenze! Verrà contata la data del documento come scadenza unica!"}):r(B,{children:[e(V,{children:r(z,{children:[e(m,{children:"Data"}),e(m,{children:"Importo"}),e(m,{sx:{width:50},align:"center",children:e(x,{})})]})}),e(R,{children:a.scadenze.map((t,n)=>r(z,{children:[e(m,{children:t.data}),r(m,{children:["€ ",t.importo]}),e(m,{children:e(k,{color:"error",onClick:()=>ae(n),children:e(x,{})})})]},n))})]})})]})})}),e(g,{mb:3,children:e(W,{children:r(g,{p:2,children:[r(p,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(p,{item:!0,xs:6,children:e(O,{variant:"h6",gutterBottom:!0,children:"Pagamenti"})}),e(p,{item:!0,xs:6,children:e(g,{sx:{textAlign:"right"},children:e(T,{onClick:()=>N(!0),children:"aggiungi"})})})]}),e(g,{mt:2,children:v.isEmpty(a.pagamenti)?e(A,{severity:"warning",variant:"outlined",children:"Questa fattura non ha pagamenti registrati"}):r(B,{children:[e(V,{children:r(z,{children:[e(m,{children:"Data"}),e(m,{children:"Importo"}),e(m,{sx:{width:50},align:"center",children:e(x,{})})]})}),e(R,{children:a.pagamenti.map((t,n)=>r(z,{children:[e(m,{children:t.data}),r(m,{children:["€ ",t.importo]}),e(m,{children:e(k,{color:"error",onClick:()=>re(n),children:e(x,{})})})]},n))})]})})]})})}),e(Ce,{open:I,handleClose:D,onSubmit:_}),e(Ie,{open:y,handleClose:M,onSubmit:te}),e(ye,{open:U,handleClose:N,onSubmit:ne}),e(me,{disabled:J,onClick:ie,loading:s}),e(De,{open:!v.isEmpty(E),children:e(A,{severity:C?"error":"success",children:E})})]})},Qe=()=>{const b=H(),{id:h}=he(),{dettagli:i,getting:o,getError:S}=P(l=>l.fatture),{list:s,listing:C,listError:E}=P(l=>l.aziende),{list:a,listing:d,listError:c}=P(l=>l.tipiDocFisc);return u.useEffect(()=>{b(ge()),b(fe()),h&&b(ve(h))},[h]),o&&C&&d?e(pe,{}):S||E||c?e(Q,{message:"Errore caricamento dati"}):!v.isEmpty(i)&&!v.isEmpty(s)&&!v.isEmpty(a)?e(ze,{dettagli:i,aziende:s,tipiDocumento:a}):e(Q,{message:"Errore caricamento dati"})};export{Qe as default};
