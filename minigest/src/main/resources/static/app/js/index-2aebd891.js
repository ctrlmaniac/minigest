import{R as s,j as n,b as e,b0 as G,b1 as M,b2 as N,f as U,F as $,l as C,ai as L,aR as _,at as J,B as K,V as Q}from"./index-b0edc525.js";import{g as X}from"./get-52608d2e.js";import{e as P,d as F,B as f,T,P as x}from"./hooks-f9dc248c.js";import{a as Y,b as Z}from"./DialogContent-5ea71aa5.js";import{T as g}from"./TextField-11ad0b6f.js";import{D as ee}from"./DialogActions-f2864aa1.js";import{B as j}from"./Button-5e2f45ca.js";import{a as te,E as ae,I as re}from"./index-c1f533ec.js";import{G as q}from"./Grid-6e4f877e.js";import{A as I}from"./Alert-bf912103.js";import{T as le,a as B,b as u,c as ne}from"./TableRow-1c21061b.js";import{T as ie}from"./TableHead-339200f6.js";import{I as W}from"./IconTrash-5556d2d5.js";import{S as se}from"./Snackbar-c1499bfb.js";import"./Grow-f5e1a89c.js";import"./Portal-3b6c3c12.js";import"./useFormControl-1aadaf80.js";import"./useControlled-467ac937.js";import"./createReactComponent-9058c6b6.js";const oe=({open:r,handleClose:c,handleSubmit:d})=>{const[a,m]=s.useState({aliquota:22,totale:0,totaleAnnulli:0,totaleResi:0}),[l,b]=s.useState({aliquota:!1,totale:!1,totaleAnnulli:!1,totaleResi:!1}),v=i=>{const{name:y,value:p,required:D}=i.target;m({...a,[y]:p}),D&&b({...l,[y]:p.length<1})},[E,h]=s.useState(!0);s.useEffect(()=>{h(!Object.values(l).every(i=>i===!1))},[l]);const S=()=>{c(!1),d(a)};return n(Y,{open:r,onClose:()=>c(!1),children:[n(Z,{children:[e(g,{label:"aliquota",name:"aliquota",value:a.aliquota,error:l.aliquota,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale",name:"totale",value:a.totale,error:l.totale,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale annulli",name:"totaleAnnulli",value:a.totaleAnnulli,error:l.totaleAnnulli,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale resi",name:"totaleResi",value:a.totaleResi,error:l.totaleResi,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"number",inputProps:{step:.01}})]}),e(ee,{children:e(j,{disabled:E,onClick:S,children:"Salva"})})]})};function ue(r,c){return async d=>{d(G()),te.put(`${ae.CHIUSURE_FISCALI}/${r}`,c).then(a=>{d(M(a.data))}).catch(a=>{let m="Errore";a.response?m=a.response.data:m="Errore",d(N(m))})}}const ce=({dettagli:r})=>{const c=P(),d=U(),{selected:a}=F(t=>t.negozi),{putting:m,putError:l,response:b}=F(t=>t.chiusureFiscali),[v,E]=s.useState(!1),[h,S]=s.useState({data:r.data,totale:r.totale,numeroDocFisc:r.numeroDocFisc}),[i,y]=s.useState([...r.reparti]),[p,D]=s.useState({data:!1,totale:!1,numeroDocFisc:!1}),R=t=>{const{name:o,value:A,required:O}=t.target;S({...h,[o]:A}),O&&D({...p,[o]:A.length<1})},[k,V]=s.useState(!0);s.useEffect(()=>{const t=!Object.values(p).every(o=>o===!1);V(t||i.length<1)},[p,i]);const w=t=>{y([...i,t])},z=t=>{const o=[...i];o.splice(t,1),y(o)},H=()=>{const t={negozio:r.negozio,...h,reparti:[...i]};c(ue(r.id,t)),setTimeout(()=>{l||d("/docfisc/chiusure-fiscali"),c(_())},2e3)};return n($,{children:[e(f,{mb:3,children:e(T,{variant:"h3",children:"Modifica Chiusura Fiscale"})}),e(f,{mb:3,children:e(x,{children:n(f,{p:2,children:[e(g,{label:"Data",name:"data",value:h.data,error:p.data,fullWidth:!0,required:!0,onChange:R,margin:"normal",type:"date"}),e(g,{label:"Totale",name:"totale",value:h.totale,error:p.totale,fullWidth:!0,required:!0,onChange:R,margin:"normal",type:"number"}),e(g,{label:"Num. D.F.",name:"numeroDocFisc",value:h.numeroDocFisc,error:p.numeroDocFisc,fullWidth:!0,required:!0,onChange:R,margin:"normal",type:"number"})]})})}),e(f,{children:e(x,{children:n(f,{p:2,children:[n(q,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(q,{item:!0,xs:6,children:e(T,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(q,{item:!0,xs:6,children:e(f,{sx:{textAlign:"right"},children:e(j,{onClick:()=>E(!0),children:"aggiungi"})})})]}),e(f,{mt:2,children:C.isEmpty(i)?e(I,{severity:"error",variant:"outlined",children:"Devi aggiungere almeno un reparto!"}):n(le,{children:[e(ie,{children:n(B,{children:[e(u,{children:"Aliquota"}),e(u,{children:"Totale"}),e(u,{children:"Annulli"}),e(u,{children:"Resi"}),e(u,{sx:{width:50},align:"center",children:e(W,{})})]})}),e(ne,{children:i.map((t,o)=>n(B,{children:[n(u,{children:[t.aliquota," %"]}),n(u,{children:[t.totale," €"]}),n(u,{children:[t.totaleAnnulli," €"]}),n(u,{children:[t.totaleResi," €"]}),e(u,{align:"center",children:e(re,{color:"error",onClick:()=>z(o),children:e(W,{})})})]},o))})]})})]})})}),e(oe,{open:v,handleClose:E,handleSubmit:w}),e(L,{onClick:H,disabled:k||C.isEmpty(a),loading:m}),e(se,{open:!C.isEmpty(b),children:e(I,{severity:l?"error":"success",children:b})})]})},Ie=()=>{const{id:r}=J(),c=P(),{getting:d,getError:a,response:m,dettagli:l}=F(b=>b.chiusureFiscali);return s.useEffect(()=>{C.isEmpty(r)||c(X(r))},[r]),d?e(K,{}):a||C.isEmpty(l)?e(Q,{message:m||"Errore caricamento chiusura fiscale"}):e(ce,{dettagli:l})};export{Ie as default};
