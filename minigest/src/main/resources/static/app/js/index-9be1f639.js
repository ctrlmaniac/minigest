import{R as s,d as a,j as e,aZ as H,a_ as G,a$ as N,i as U,F as V,l as C,ai as _,aR as $}from"./index-6a75a5de.js";import{f as L,e as E,B as p,T as F,P as x}from"./hooks-8b6b3ce5.js";import{a as Z,b as J}from"./DialogContent-f20a2445.js";import{T as g}from"./TextField-09f22a56.js";import{D as K}from"./DialogActions-3e4a0005.js";import{B}from"./Button-2bd02b9a.js";import{a as M,E as Q,I as X}from"./index-db9e3c6a.js";import{A as D}from"./Alert-863a23eb.js";import{A as Y}from"./AlertTitle-c2d2966c.js";import{I as ee}from"./IconBuildingStore-70e274f4.js";import{G as q}from"./Grid-f0b91695.js";import{T as te,a as I,b as o,c as ae}from"./TableRow-c65b3546.js";import{T as re}from"./TableHead-40379dbf.js";import{I as z}from"./IconTrash-2431d59b.js";import{S as ie}from"./Snackbar-c915bc05.js";import"./Grow-234efcfb.js";import"./useFormControl-ec2a69e6.js";import"./createReactComponent-2662947b.js";const ne=({open:f,handleClose:d,handleSubmit:i})=>{const[r,S]=s.useState({aliquota:22,totale:0,totaleAnnulli:0,totaleResi:0}),[n,A]=s.useState({aliquota:!1,totale:!1,totaleAnnulli:!1,totaleResi:!1}),m=b=>{const{name:c,value:y,required:v}=b.target;S({...r,[c]:y}),v&&A({...n,[c]:y.length<1})},[h,R]=s.useState(!0);s.useEffect(()=>{R(!Object.values(n).every(b=>b===!1))},[n]);const u=()=>{d(!1),i(r)};return a(Z,{open:f,onClose:()=>d(!1),children:[a(J,{children:[e(g,{label:"aliquota",name:"aliquota",value:r.aliquota,error:n.aliquota,fullWidth:!0,required:!0,onChange:m,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale",name:"totale",value:r.totale,error:n.totale,fullWidth:!0,required:!0,onChange:m,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale annulli",name:"totaleAnnulli",value:r.totaleAnnulli,error:n.totaleAnnulli,fullWidth:!0,required:!0,onChange:m,margin:"normal",type:"number",inputProps:{step:.01}}),e(g,{label:"totale resi",name:"totaleResi",value:r.totaleResi,error:n.totaleResi,fullWidth:!0,required:!0,onChange:m,margin:"normal",type:"number",inputProps:{step:.01}})]}),e(K,{children:e(B,{disabled:h,onClick:u,children:"Salva"})})]})};function le(f){return async d=>{d(H()),M.post(`${Q.CHIUSURE_FISCALI}`,f).then(i=>{d(G(i.data))}).catch(i=>{let r="Errore";i.response?r=i.response.data:r="Errore",d(N(r))})}}const qe=()=>{const f=L(),d=U(),{selected:i}=E(t=>t.negozi),{posting:r,postError:S,response:n}=E(t=>t.chiusureFiscali),[A,m]=s.useState(!1),[h,R]=s.useState({data:new Date().toISOString().split("T")[0],totale:0,numeroDocFisc:0}),[u,b]=s.useState([]),[c,y]=s.useState({data:!1,totale:!1,numeroDocFisc:!1}),v=t=>{const{name:l,value:T,required:O}=t.target;R({...h,[l]:T}),O&&y({...c,[l]:T.length<1})},[W,P]=s.useState(!0);s.useEffect(()=>{const t=!Object.values(c).every(l=>l===!1);P(t||u.length<1)},[c,u]);const j=t=>{b([...u,t])},k=t=>{const l=[...u];l.splice(t,1),b(l)},w=()=>{const t={negozio:i,...h,reparti:[...u]};f(le(t)),S||setTimeout(()=>{f($()),d("/docfisc/chiusure-fiscali")},1e3)};return a(V,{children:[e(p,{mb:3,children:e(F,{variant:"h3",children:"Aggiungi Chiusura Fiscale"})}),C.isEmpty(i)?a(D,{variant:"outlined",severity:"error",sx:{marginBottom:3},children:[e(Y,{children:"Devi selezionare un negozio!"}),"Per visualizzare le chiusure fiscali devi prima selezionare un negozio. Clicca sull'icona ",e(ee,{})," in alto a sinistra e selezionane uno!"]}):a(D,{variant:"outlined",severity:"info",sx:{marginBottom:3},children:["Stai aggiungendo una chiusura fiscale al negozio ",i.nome]}),e(p,{mb:3,children:e(x,{children:a(p,{p:2,children:[e(g,{label:"Data",name:"data",value:h.data,error:c.data,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"date"}),e(g,{label:"Totale",name:"totale",value:h.totale,error:c.totale,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"number"}),e(g,{label:"Num. D.F.",name:"numeroDocFisc",value:h.numeroDocFisc,error:c.numeroDocFisc,fullWidth:!0,required:!0,onChange:v,margin:"normal",type:"number"})]})})}),e(p,{children:e(x,{children:a(p,{p:2,children:[a(q,{container:!0,direction:"row",justifyContent:"space-around",alignItems:"center",children:[e(q,{item:!0,xs:6,children:e(F,{variant:"h6",gutterBottom:!0,children:"Reparti"})}),e(q,{item:!0,xs:6,children:e(p,{sx:{textAlign:"right"},children:e(B,{onClick:()=>m(!0),children:"aggiungi"})})})]}),e(p,{mt:2,children:C.isEmpty(u)?e(D,{severity:"error",children:"Devi aggiungere almeno un reparto!"}):a(te,{children:[e(re,{children:a(I,{children:[e(o,{children:"Aliquota"}),e(o,{children:"Totale"}),e(o,{children:"Annulli"}),e(o,{children:"Resi"}),e(o,{sx:{width:50},align:"center",children:e(z,{})})]})}),e(ae,{children:u.map((t,l)=>a(I,{children:[a(o,{children:[t.aliquota," %"]}),a(o,{children:[t.totale," €"]}),a(o,{children:[t.totaleAnnulli," €"]}),a(o,{children:[t.totaleResi," €"]}),e(o,{align:"center",children:e(X,{color:"error",onClick:()=>k(l),children:e(z,{})})})]},l))})]})})]})})}),e(ne,{open:A,handleClose:m,handleSubmit:j}),e(_,{onClick:w,disabled:W||C.isEmpty(i),loading:r}),e(ie,{open:!C.isEmpty(n),children:e(D,{severity:S?"error":"success",children:n})})]})};export{qe as default};
